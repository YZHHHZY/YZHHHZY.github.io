<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/%E5%8D%9A%E5%AE%A2.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/%E5%8D%9A%E5%AE%A2-copy.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="API现在介绍的只是Java层的API 注意frida代码需要写在 Java.perform(function() &#123;&#125;); 函数体中，下面省略不写了 静态方法和实例方法的hook">
<meta property="og:type" content="article">
<meta property="og:title" content="逆向学习 0x06JAVA层hook的API">
<meta property="og:url" content="http://example.com/2024/10/15/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0-0x06-JAVA%E5%B1%82hook%E7%9A%84API/index.html">
<meta property="og:site_name" content="妙妙屋">
<meta property="og:description" content="API现在介绍的只是Java层的API 注意frida代码需要写在 Java.perform(function() &#123;&#125;); 函数体中，下面省略不写了 静态方法和实例方法的hook">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241016112901816.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241016113231981.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241016113314869.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241017192903835.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241017193046511.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241021083842196.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241021085640901.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241021085159066.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241021090808965.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241021091445508.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241021093410843.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241021094753946.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241021100342745.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241021100657763.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241021174344517.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241021180237078.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241021185206996.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241021190736252.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241021190636980.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241021192603865.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241021193047976.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241021194022869.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241022215523856.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241023110937621.png">
<meta property="article:published_time" content="2024-10-15T08:41:58.000Z">
<meta property="article:modified_time" content="2025-03-13T09:35:55.158Z">
<meta property="article:author" content="没事数命的猫">
<meta property="article:tag" content="安卓逆向">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241016112901816.png">

<link rel="canonical" href="http://example.com/2024/10/15/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0-0x06-JAVA%E5%B1%82hook%E7%9A%84API/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>逆向学习 0x06JAVA层hook的API | 妙妙屋</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">妙妙屋</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">思而不学则殆</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/15/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0-0x06-JAVA%E5%B1%82hook%E7%9A%84API/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="没事数命的猫">
      <meta itemprop="description" content="学而不思则罔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="妙妙屋">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          逆向学习 0x06JAVA层hook的API
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-10-15 16:41:58" itemprop="dateCreated datePublished" datetime="2024-10-15T16:41:58+08:00">2024-10-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-13 17:35:55" itemprop="dateModified" datetime="2025-03-13T17:35:55+08:00">2025-03-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">逆向学习</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>17 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><p>现在介绍的只是Java层的API</p>
<p>注意frida代码需要写在 <code>Java.perform(function() &#123;&#125;);</code> 函数体中，下面省略不写了</p>
<h4 id="静态方法和实例方法的hook"><a href="#静态方法和实例方法的hook" class="headerlink" title="静态方法和实例方法的hook"></a>静态方法和实例方法的hook</h4><span id="more"></span>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不需要区分修饰符，也不需要区分静态方法和实例方法，hook代码的写法都是一样的</span></span><br><span class="line"><span class="comment">// 无论带不带static都可以直接hook</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 得到要hook的类的对象</span></span><br><span class="line"><span class="keyword">var</span> xxx = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.xxxx.xxx&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// hook实例方法</span></span><br><span class="line">xxx.(方法).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="variable language_">this</span>.(方法)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;xxx :&quot;</span>, result)</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="函数参数和返回值的修改"><a href="#函数参数和返回值的修改" class="headerlink" title="函数参数和返回值的修改"></a>函数参数和返回值的修改</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> money = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.hello.demo.money&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> str = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.String&quot;</span>)</span><br><span class="line">money.<span class="property">getInfo</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">a</span>) &#123;</span><br><span class="line">	<span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="title function_">getInfo</span>(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line">	<span class="keyword">return</span> str.$new(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 这里直接返回 &quot;hello world&quot; 是没有什么问题的，这是因为frida会自动帮忙处理掉这些问题</span></span><br><span class="line">    <span class="comment">// &quot;hello world&quot; 这个是JS类型的字符串，而函数需要的返回值是Java类型的字符串，需要进行一个转化</span></span><br><span class="line">    <span class="comment">// frida 是会自动处理这个问题的，但是在一些情况下可能处理不了</span></span><br><span class="line">    <span class="comment">// 这个时候就需要手动来进行一个转换了，就是调用String方法来new String</span></span><br><span class="line">    <span class="comment">// 在参数传递上也是类似的</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="构造方法的hook"><a href="#构造方法的hook" class="headerlink" title="构造方法的hook"></a>构造方法的hook</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基本上都是使用$init来表示构造函数，例外：String</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> money = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.hello.demo.money&quot;</span>)</span><br><span class="line">money.<span class="property">$init</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="property">$init</span>;</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> str = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.StringFactory&quot;</span>)</span><br><span class="line">str.<span class="property">newStringFromString</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">a</span>) &#123;</span><br><span class="line">    <span class="comment">// ……………………</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="对象参数的构造和修改"><a href="#对象参数的构造和修改" class="headerlink" title="对象参数的构造和修改"></a>对象参数的构造和修改</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 其实上面那个String就是一种构造</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wallet = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> money = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">wallet.(方法).<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">a</span>) &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br><span class="line">	<span class="keyword">return</span> <span class="variable language_">this</span>.方法(money.$new(<span class="string">&quot;你好&quot;</span>, <span class="number">200</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个$new其实就是一种构造，在需要传递自己定义的类型数据的时候执行，只需要找到相应的类，然后进行$new</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wallet = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">wallet.(方法).<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">a</span>) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// console.log(a);</span></span><br><span class="line">    <span class="comment">// 这里的a类型，如果没有toString方法的话，是只能打印出返回值的</span></span><br><span class="line">    <span class="comment">// 需要自己去找相应的变量名，去点出方法获取输出，或者点变量再点value</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="property">currency</span>.<span class="property">value</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="property">getCurrency</span>);</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// 如果要进行修改操作</span></span><br><span class="line">    <span class="comment">// 也是两个操作，第一个是找到要更改的变量直接点value进行更改</span></span><br><span class="line">    <span class="comment">// 第二个是找到更改的方法执行</span></span><br><span class="line">    a.<span class="property">amount</span>.<span class="property">value</span> = <span class="number">3000</span>;</span><br><span class="line">    a.<span class="title function_">setAmount</span>(<span class="number">3000</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="variable language_">this</span>.方法(a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="HashMap的打印"><a href="#HashMap的打印" class="headerlink" title="HashMap的打印"></a>HashMap的打印</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> utils = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> stringBuilder = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.StringBuilder&quot;</span>);</span><br><span class="line">utils.方法.<span class="property">implementation</span>. = <span class="keyword">function</span>(<span class="params">a</span>) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 如果传入的参数是HashMap类型的，无法向下转型，自然也没有toString方法，这个时候就需要手动将内容打印出来</span></span><br><span class="line">    <span class="comment">// keySet()方法是获取到key值</span></span><br><span class="line">	<span class="keyword">var</span> key = a.<span class="title function_">keySet</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 定义一个迭代器</span></span><br><span class="line">	<span class="keyword">var</span> it = key.<span class="title function_">iterator</span>();</span><br><span class="line">	<span class="keyword">var</span> result = stringBuilder.$new();</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// 迭代器方法类似于for循环</span></span><br><span class="line">	<span class="keyword">while</span>(it.<span class="title function_">hasNext</span>()) &#123;</span><br><span class="line">		<span class="keyword">var</span> keystr = it.<span class="title function_">next</span>();</span><br><span class="line">		<span class="keyword">var</span> valuestr = a.<span class="title function_">get</span>(keystr);</span><br><span class="line">		result.<span class="title function_">append</span>(valuestr);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(result.<span class="title function_">toString</span>());</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="title function_">shufferMap</span>(a);</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 题外话，如果是byte数组，就使用 JSON.stringify() 处理</span></span><br></pre></td></tr></table></figure>



<h4 id="重载方法的hook"><a href="#重载方法的hook" class="headerlink" title="重载方法的hook"></a>重载方法的hook</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">z<span class="comment">// 之前比比皆是，在 implementation 前加上 overload() 括号内指定类型</span></span><br><span class="line"><span class="comment">// 这个也不用特意的去管他，如果碰到重载方法，一执行就会提示相应的类型，复制粘贴即可</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> str = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.String&quot;</span>)</span><br><span class="line">str.<span class="property">getBytes</span>.<span class="title function_">overload</span>().<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;getBytes() called&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span>.<span class="title function_">getBytes</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个东西太慢了，尤其是重载方法比较多的时候</span></span><br><span class="line"><span class="comment">// 直接hook所有重载方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 利用frida中的一个方法获取到所有的重载方法，复写implementation方法，便利这个数组</span></span><br><span class="line"><span class="keyword">var</span> utils = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.xxx.xxx&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> overloadsArr = utils.方法.<span class="property">overloads</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; overloadsArr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    overloadsArr[i].<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> params = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="variable language_">arguments</span>.<span class="property">length</span>; j++) &#123;</span><br><span class="line">            params += <span class="variable language_">arguments</span>[j] + <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(params);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 介绍一下JS中的两个小方法</span></span><br><span class="line">        <span class="comment">// call 和 apply</span></span><br><span class="line">        <span class="comment">// 下面这个就相当于 this.方法(arguments) 这个东西</span></span><br><span class="line">        <span class="comment">// 这两个的区别是接收多个参数还是单个，如果是call 的话就需要将参数挨个传入</span></span><br><span class="line">        <span class="comment">// 如果要根据参数的个数不同进行处理的话，使用 if(arguments.length)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.方法.<span class="title function_">apply</span>(<span class="variable language_">this</span>， <span class="variable language_">arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>hook全部重载方法的这个了解就可以了，有相关的命令可以解决这个问题，遇到命令解决不了的，再来手敲</p>
<h4 id="主动调用"><a href="#主动调用" class="headerlink" title="主动调用"></a>主动调用</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对于静态方法，直接打印调用即可</span></span><br><span class="line"><span class="keyword">var</span> money = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.xxx.xxxx&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(money.方法())</span><br><span class="line"><span class="comment">// 这样这个静态方法就调用成功了</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果用同样的方法来调用非static修饰的方法那就出事了，会报错</span></span><br><span class="line"><span class="comment">// Error: 方法名: cannot call instance method without an instance</span></span><br><span class="line"><span class="comment">// 不使用 一个对象就不能调用方法</span></span><br><span class="line"><span class="comment">// 现在需要一个对象，方法一，新建一个对象</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(money.<span class="property">$new</span>.方法())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法二，获取已有的对象</span></span><br><span class="line"><span class="comment">// 要和需要获取的对象的位置相同</span></span><br><span class="line"><span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;com.xxx.xxxx&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">onMatch</span>: <span class="keyword">function</span> (<span class="params">obj</span>) &#123;</span><br><span class="line">        <span class="comment">// 主动调用成功</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(obj.方法());</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onComplete</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;END&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Android Context的获取</span></span><br><span class="line"><span class="keyword">var</span> current_application = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.app.ActivityThread&quot;</span>).<span class="title function_">cuttrntApplication</span>();</span><br><span class="line"><span class="keyword">var</span> content = current_application.<span class="title function_">getApplicationContext</span>();</span><br></pre></td></tr></table></figure>



<h4 id="获取和修改类的字段"><a href="#获取和修改类的字段" class="headerlink" title="获取和修改类的字段"></a>获取和修改类的字段</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 静态字段</span></span><br><span class="line"><span class="keyword">var</span> money = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.xxx.xxxx&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(money.变量名.<span class="property">value</span>);</span><br><span class="line">money.变量名.<span class="property">value</span> = <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(money.变量名.<span class="property">value</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例字段 创建新对象</span></span><br><span class="line"><span class="keyword">var</span> moneyObj = money.$new();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(moneyObj.变量名.<span class="property">value</span>)</span><br><span class="line">money.变量名.<span class="property">value</span> = <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(money.变量名.<span class="property">value</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例字段(获取已有对象)</span></span><br><span class="line"><span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;com.xxx.xxxx&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">onMatch</span>: <span class="keyword">function</span> (<span class="params">obj</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(obj.变量名.<span class="property">value</span>);</span><br><span class="line">    &#125;, <span class="attr">onComplete</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果有字段名和方法名一样，如果想要获取到属性需要加下划线前缀</span></span><br><span class="line"><span class="comment">// 例如一个类中有一个accountName属性也有一个accountName方法，如果想要指定accountName属性，需要加_</span></span><br><span class="line"><span class="comment">// 调用方法直接用即可</span></span><br><span class="line"><span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;com.xxx.xxxx&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">onMatch</span>: <span class="keyword">function</span> (<span class="params">obj</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">_accountName</span>.<span class="property">value</span>);</span><br><span class="line">    &#125;, <span class="attr">onComplete</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>





<h4 id="hook内部类和匿名类"><a href="#hook内部类和匿名类" class="headerlink" title="hook内部类和匿名类"></a>hook内部类和匿名类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">内部类简单来说就是class中的class</span><br><span class="line">比如调用R文件中的内部类</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">tset</span> &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">a</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">com.xxx.xxx.R$id</span><br><span class="line"><span class="comment">// 这个就是调用了R中的内部类id</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">// 这里创建的就是匿名类，方法没有名字，也就是说hook这个getInfo()方法是hook不到东西的</span></span><br><span class="line"><span class="comment">// 只能使用 $ + 数字进行hook，比如 com.demo.tast$1</span></span><br><span class="line"><span class="comment">// 这个数字从1开始排序，从上到下</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">	System.out.println(<span class="keyword">new</span> <span class="title class_">people</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">19</span>) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getInfo</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> getName() + <span class="string">&quot;&quot;</span> + getAge();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.getInfo());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hook内部类，需要使用Java.choose来获取匿名对象</span></span><br><span class="line"><span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;com.xxx.xxxx$a&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">onMatch</span>: <span class="keyword">function</span> (<span class="params">obj</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">_accountName</span>.<span class="property">value</span>);</span><br><span class="line">    &#125;, <span class="attr">onComplete</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// hook匿名类</span></span><br><span class="line"><span class="keyword">var</span> people$1 = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.xxx.people$1);</span></span><br><span class="line"><span class="string">people$1.getInfo.implementation = function() &#123;</span></span><br><span class="line"><span class="string">    var result = this.getInfo();</span></span><br><span class="line"><span class="string">    return result;</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 如果有匿名内部类就使用Java.choose进行嵌套即可，如果太过于复杂，可以直接遍历所有的类，直接去搜索</span></span><br></pre></td></tr></table></figure>





<h4 id="混淆函数的hook方法"><a href="#混淆函数的hook方法" class="headerlink" title="混淆函数的hook方法"></a>混淆函数的hook方法</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数被混淆之后，这个时候直接根据它的名字hook即可，如果有乱码或者难以填写可以进行编码，将编码后的数据去JS脚本中解密，用变量来表示名称</span></span><br><span class="line"><span class="comment">// 假如进行了base64编码处理</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> people = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.xxx.xxxx&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> base64 = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.util.Base64&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> str = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.String&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> funcName = str.$new(base64.<span class="title function_">decode</span>(<span class="string">&quot;Z2V0SW5mbw==&quot;</span>, <span class="number">0</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(funcName);</span><br><span class="line">people[funcName].<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="title function_">funcName</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>做一个小小的混淆，就是将类名、方法名进行base64加密</p>
<p>如果要更改dex中的类名，需要用到一个库dexlib2</p>
<p>输出结果：</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241016112901816.png" alt="image-20241016112901816"></p>
<p>混淆前后对比</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241016113231981.png" alt="image-20241016113231981"></p>
<p>面对混淆的名字，jadx可能会处理一部分，如果出现注释和名字不一样的，以注释为准进行hook</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241016113314869.png" alt="image-20241016113314869"></p>
<p>混淆代码</p>
<p>因为是使用Android开发的，所有目录在安卓端，运行比较慢，也可以使用Java写</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 读取原本的dex和新创建的dex，这里是手机中的文件路径</span></span><br><span class="line">            <span class="type">File</span> <span class="variable">oldDexFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/data/data/com.example.demo/classes.dex&quot;</span>);</span><br><span class="line">            <span class="type">File</span> <span class="variable">newDexFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/data/data/com.example.demo/new_classes.dex&quot;</span>);</span><br><span class="line"></span><br><span class="line">            Log.d(<span class="string">&quot;demo&quot;</span>, <span class="string">&quot;从assets中读取classes.dex&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 打开放在assets目录下的dex文件，输入流，然后将文件写出到app私有空间去</span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">ins</span> <span class="operator">=</span> getApplicationContext().getAssets().open(<span class="string">&quot;classes.dex&quot;</span>);</span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="type">int</span> index;</span><br><span class="line">            <span class="keyword">while</span> ((index = ins.read(bytes)) != -<span class="number">1</span>)</span><br><span class="line">                baos.write(bytes, <span class="number">0</span> ,index);</span><br><span class="line">            </span><br><span class="line">            Log.d(<span class="string">&quot;demo&quot;</span>, <span class="string">&quot;开始写出classes.dex到&quot;</span> + oldDexFile.toString() + <span class="string">&quot;...&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(oldDexFile);</span><br><span class="line">            fos.write(baos.toByteArray());</span><br><span class="line">            ins.close();</span><br><span class="line">            fos.close();</span><br><span class="line">            baos.close();</span><br><span class="line">            </span><br><span class="line">            Log.d(<span class="string">&quot;demo&quot;</span>, <span class="string">&quot;开始使用dexlib2加载classes.dex...&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 指明api版本</span></span><br><span class="line">            <span class="type">Opcodes</span> <span class="variable">opcodes</span> <span class="operator">=</span> Opcodes.forApi(<span class="number">29</span>);</span><br><span class="line">            <span class="comment">// DexFileFactory.loadDexFile(oldDexFile, opcodes)是用来指明dex文件，两个参数为路径和api版本</span></span><br><span class="line">            <span class="comment">// 这一步的操作是将dex文件不进行修改直接写进来，如果这一步报错了其他也没戏，就是一个测试属于是</span></span><br><span class="line">            DexFileFactory.writeDexFile(oldDexFile.toString(), DexFileFactory.loadDexFile(oldDexFile, opcodes));</span><br><span class="line">            <span class="comment">// 重新将dex文件加载进来</span></span><br><span class="line">            <span class="type">DexBackedDexFile</span> <span class="variable">dexBackedDexFile</span> <span class="operator">=</span> DexFileFactory.loadDexFile(oldDexFile, opcodes);</span><br><span class="line">            Log.d(<span class="string">&quot;demo&quot;</span>, <span class="string">&quot;dexFile:&quot;</span> + dexBackedDexFile.getClass().getName());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 设定要更改的内容</span></span><br><span class="line">            <span class="type">DexRewriter</span> <span class="variable">rewriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DexRewriter</span>(<span class="keyword">new</span> <span class="title class_">RewriterModule</span>() &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// getClassDefRewriter获取一个类的时候调用该方法</span></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> Rewriter&lt;ClassDef&gt; <span class="title function_">getClassDefRewriter</span><span class="params">(Rewriters rewriters)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ClassDefRewriter</span>(rewriters) &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="keyword">public</span> ClassDef <span class="title function_">rewrite</span><span class="params">(ClassDef classDef)</span> &#123;</span><br><span class="line">                            <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> classDef.getType();</span><br><span class="line"></span><br><span class="line">                            <span class="comment">// 获取类名，如果类名包含com.example就重写，getType()方法中是获取类名后进行重写的具体操作</span></span><br><span class="line">                            <span class="keyword">if</span> (className.contains(<span class="string">&quot;com/dodonew&quot;</span>)) &#123;</span><br><span class="line">                                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RewrittenClassDef</span>(classDef) &#123;</span><br><span class="line">                                    <span class="meta">@Override</span></span><br><span class="line">                                    <span class="keyword">public</span> String <span class="title function_">getType</span><span class="params">()</span> &#123;</span><br><span class="line">                                        <span class="type">String</span> <span class="variable">class_fullName</span> <span class="operator">=</span> classDef.getType();</span><br><span class="line">                                        <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> class_fullName.lastIndexOf(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">                                        <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> class_fullName.lastIndexOf(<span class="string">&quot;$&quot;</span>);</span><br><span class="line">                                        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> class_fullName.length();</span><br><span class="line">                                        <span class="keyword">if</span> (end &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                                            <span class="keyword">if</span> (class_fullName.contains(<span class="string">&quot;;&quot;</span>)) &#123;</span><br><span class="line">                                                end = length - <span class="number">1</span>;</span><br><span class="line">                                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                                end = length;</span><br><span class="line">                                            &#125;</span><br><span class="line">                                        &#125;</span><br><span class="line"></span><br><span class="line">                                        <span class="comment">// 进行base64编码，替换旧名字</span></span><br><span class="line">                                        <span class="type">String</span> <span class="variable">class_name</span> <span class="operator">=</span> class_fullName.substring(start + <span class="number">1</span>, end);</span><br><span class="line">                                        <span class="type">String</span> <span class="variable">class_name_enc</span> <span class="operator">=</span> Base64.encodeToString(class_name.getBytes(), <span class="number">0</span>);</span><br><span class="line">                                        Log.d(<span class="string">&quot;demo&quot;</span>, class_name + <span class="string">&quot;&quot;</span> + class_name_enc);</span><br><span class="line">                                        <span class="keyword">return</span> class_fullName.replace(class_name, class_name_enc);</span><br><span class="line">                                    &#125;</span><br><span class="line"></span><br><span class="line">                                    <span class="meta">@Override</span></span><br><span class="line">                                    <span class="keyword">public</span> String <span class="title function_">getSourceFile</span><span class="params">()</span> &#123;<span class="keyword">return</span> <span class="literal">null</span>;&#125;</span><br><span class="line">                                &#125;;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">return</span> <span class="built_in">super</span>.rewrite(classDef);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// getFieldRewriter获取类中的一个字段的时候调用该方法</span></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> Rewriter&lt;Field&gt; <span class="title function_">getFieldRewriter</span><span class="params">(Rewriters rewriters)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FieldRewriter</span>(rewriters) &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="keyword">public</span> Field <span class="title function_">rewrite</span><span class="params">(Field field)</span> &#123;</span><br><span class="line">                            <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> field.getDefiningClass();</span><br><span class="line">                            <span class="keyword">if</span> (className.contains(<span class="string">&quot;com/dodonew&quot;</span>)) &#123;</span><br><span class="line">                                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RewrittenField</span>(field) &#123;</span><br><span class="line">                                    <span class="meta">@Override</span></span><br><span class="line">                                    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">                                        <span class="keyword">return</span> Base64.encodeToString(field.getName().getBytes(), <span class="number">0</span>);</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">return</span> <span class="built_in">super</span>.rewrite(field);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// getMethodRewriter获取方法的时候调用该方法</span></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> Rewriter&lt;Method&gt; <span class="title function_">getMethodRewriter</span><span class="params">(Rewriters rewriters)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MethodRewriter</span>(rewriters) &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="keyword">public</span> Method <span class="title function_">rewrite</span><span class="params">(Method value)</span> &#123;</span><br><span class="line">                            <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> value.getDefiningClass();</span><br><span class="line">                            <span class="keyword">if</span> (className.contains(<span class="string">&quot;com/dodonew&quot;</span>)) &#123;</span><br><span class="line">                                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RewrittenMethod</span>(value) &#123;</span><br><span class="line">                                    <span class="meta">@Override</span></span><br><span class="line">                                    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">                                        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> Base64.encodeToString(value.getName().getBytes(), <span class="number">0</span>);</span><br><span class="line">                                        Log.d(<span class="string">&quot;demo&quot;</span>, <span class="string">&quot;methodName:&quot;</span> + methodName);</span><br><span class="line">                                        <span class="keyword">return</span> methodName;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">return</span> <span class="built_in">super</span>.rewrite(value);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将设定好的rewrite保存，这个写的是dexBackedDexFile，这是一开始加载的dex就相当于覆盖写出了</span></span><br><span class="line">            <span class="type">DexFile</span> <span class="variable">rewriteDexFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DexFileRewriter</span>(rewriter).rewrite(dexBackedDexFile);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将改好的dex写出保存</span></span><br><span class="line">            <span class="type">DexPool</span> <span class="variable">dexPool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DexPool</span>(rewriteDexFile.getOpcodes());</span><br><span class="line">            <span class="keyword">for</span> (ClassDef classDef : rewriteDexFile.getClasses()) &#123;</span><br><span class="line">                dexPool.internClass(classDef);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            dexPool.writeTo(<span class="keyword">new</span> <span class="title class_">FileDataStore</span>(newDexFile));</span><br><span class="line">            Log.d(<span class="string">&quot;demo&quot;</span>, <span class="string">&quot;new_classes.dex生成完毕，保存路径为：&quot;</span> + newDexFile.toString());</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="枚举所有已加载的类与枚举类的所有方法"><a href="#枚举所有已加载的类与枚举类的所有方法" class="headerlink" title="枚举所有已加载的类与枚举类的所有方法"></a>枚举所有已加载的类与枚举类的所有方法</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这个之前就用过一个一键打印所有已经加载的类的方法</span></span><br><span class="line"><span class="comment">// 1、注意是已加载不是所有</span></span><br><span class="line"><span class="comment">// 2、加载的类也不一定能hook到，原因是存在类加载器，有的类的类加载器和正在使用的类加载器不一样，会找不到这个类，但是会被打印出来</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Java</span>.<span class="title function_">enumerateLoadedClassesSync</span>().<span class="title function_">join</span>(<span class="string">&quot;\n&quot;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 枚举类的所有方法</span></span><br><span class="line"><span class="comment">// 实现思想呢就是Java中的反射思想</span></span><br><span class="line"><span class="comment">// 第一步就是获取class对象，这个和Java中的实现不一样直接use就行了</span></span><br><span class="line"><span class="keyword">var</span> people = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.xxx.xxxx.People&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取函数名、构造函数、字段、内部类</span></span><br><span class="line"><span class="keyword">var</span> methods = people.<span class="property">class</span>.<span class="title function_">getDeclaredMethods</span>();</span><br><span class="line"><span class="keyword">var</span> constructors = people.<span class="property">class</span>.<span class="title function_">getDeclaredConstructors</span>();</span><br><span class="line"><span class="keyword">var</span> fields = people.<span class="property">class</span>.<span class="title function_">getDeclaredFields</span>();</span><br><span class="line"><span class="keyword">var</span> classes = people.<span class="property">class</span>.<span class="title function_">getDeclaredClasses</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; methods.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(methods[i].<span class="title function_">getName</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;============================&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; fields.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(constructors[i].<span class="title function_">getName</span>())</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;============================&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; fields.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(fields[i].<span class="title function_">getName</span>())</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;============================&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; fields.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(classes[i].<span class="title function_">getName</span>())</span><br><span class="line">    <span class="comment">// classes[i] 这里得到的已经是类的字节码，不需要再.class</span></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Wallet</span>$InnerStructure = classes[i].<span class="title function_">getDeclaredFields</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="title class_">Wallet</span>$InnerStructure.<span class="property">length</span>; j++) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Wallet</span>$InnerStructure[j].<span class="title function_">getName</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="hook类的所有方法"><a href="#hook类的所有方法" class="headerlink" title="hook类的所有方法"></a>hook类的所有方法</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hookFunc</span>(<span class="params">methodName</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(methodName)</span><br><span class="line">    <span class="keyword">var</span> overloadsArr = utils[methodName].<span class="property">overloads</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; overloadsArr.<span class="property">length</span>; j++) &#123;</span><br><span class="line">        overloadsArr[j].<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> params = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> k = <span class="number">0</span>; k &lt; <span class="variable language_">arguments</span>.<span class="property">length</span>; k++) &#123;</span><br><span class="line">                params += <span class="variable language_">arguments</span>[k] + <span class="string">&quot; &quot;</span>;                    </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;utils.&quot;</span> + methodName + <span class="string">&quot;is called! params is: &quot;</span>, params);</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>[methodName].<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> utils = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.dodonew.online.DodonewOnlineApplication&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> methods = utils.<span class="property">class</span>.<span class="title function_">getDeclaredMethods</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;1&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; methods.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> methodName = methods[i].<span class="title function_">getName</span>();</span><br><span class="line">    <span class="title function_">hookFunc</span>(methodName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/../%E5%9B%BE%E7%89%87/image-20241017192903835.png" alt="image-20241017192903835"></p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241017193046511.png" alt="image-20241017193046511"></p>
<h4 id="注入dex"><a href="#注入dex" class="headerlink" title="注入dex"></a>注入dex</h4><h5 id="Java-registerClass"><a href="#Java-registerClass" class="headerlink" title="Java.registerClass"></a>Java.registerClass</h5><p>这个是使用JS语言写的，frida注入之后可能会出现bug</p>
<p>这个必须需要实现一个接口，这个还是比较麻烦的，接口内的东西还需要都实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">MyWeirdTrustManager</span> = <span class="title class_">Java</span>.<span class="title function_">registerClass</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;com.dodonew.online.MyWeirdTrustManager&quot;</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 实现接口，这个貌似是必须要实现一个接口才行</span></span><br><span class="line">        <span class="attr">implements</span>: [<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;接口名&quot;</span>)],</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 继承父类</span></span><br><span class="line">        <span class="attr">superClass</span>: </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 定义变量</span></span><br><span class="line">        <span class="attr">fields</span>: &#123;</span><br><span class="line">            <span class="attr">description</span>: <span class="string">&#x27;java.lang.String&#x27;</span>,</span><br><span class="line">            <span class="attr">limit</span>: <span class="string">&#x27;int&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 定义方法</span></span><br><span class="line">        <span class="attr">methods</span>: &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 构建方法</span></span><br><span class="line">            $init() &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Constructor called&quot;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 重载方法需要使用中括号</span></span><br><span class="line">            <span class="attr">test1</span>: [&#123;</span><br><span class="line">                <span class="attr">returnType</span>: <span class="string">&#x27;void&#x27;</span>,</span><br><span class="line">                <span class="attr">argumentTypes</span>: [],</span><br><span class="line">                <span class="title function_">implementation</span>(<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;test1 called&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,&#123;</span><br><span class="line">                <span class="attr">returnType</span>: <span class="string">&#x27;void&#x27;</span>,</span><br><span class="line">                <span class="attr">argumentTypes</span>: [<span class="string">&quot;java.lang.String&quot;</span>, <span class="string">&quot;int&quot;</span>],</span><br><span class="line">                <span class="title function_">implementation</span>(<span class="params">str, num</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;test1 called with &quot;</span> + str + <span class="string">&quot; and &quot;</span> + num)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;],</span><br><span class="line">            <span class="title function_">test2</span>(<span class="params">str, num</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;test2 called with &quot;</span> + str + <span class="string">&quot; and &quot;</span> + num)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> myObj = <span class="title class_">MyWeirdTrustManager</span>.$new();</span><br><span class="line">    myObj.<span class="title function_">test1</span>();</span><br><span class="line">    myObj.<span class="title function_">test1</span>(<span class="string">&quot;Hello&quot;</span>, <span class="number">123</span>);</span><br><span class="line">    myObj.<span class="title function_">test2</span>(<span class="string">&quot;World&quot;</span>, <span class="number">456</span>);</span><br><span class="line">    myObj.<span class="property">limit</span>.<span class="property">value</span> = <span class="number">100</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(myObj.<span class="property">limit</span>.<span class="property">value</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p><img src="/../%E5%9B%BE%E7%89%87/image-20241021083842196.png" alt="image-20241021083842196"></p>
<h5 id="frida注入dex"><a href="#frida注入dex" class="headerlink" title="frida注入dex"></a>frida注入dex</h5><p>这个操作是自己写好一个dex文件，将其注入到app中去然后再调用其中的方法</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241021085640901.png" alt="image-20241021085640901"></p>
<p>先使用studio打包一个自己随便写的apk，然后取出classes.dex文件，将这个文件放到手机的 &#x2F;data&#x2F;local&#x2F;tmp 路径下</p>
<p>在进行注入，这样的方法是写成Java类型的，容易纠错和编写</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">openClassFile</span>(<span class="string">&quot;/data/local/tmp/patch.dex&quot;</span>).<span class="title function_">load</span>();</span><br><span class="line">   <span class="keyword">var</span> use = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.example.demo.test&quot;</span>);</span><br><span class="line">   <span class="keyword">var</span> obj =  use.<span class="title function_">test</span>();</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(obj);</span><br></pre></td></tr></table></figure>



<p><img src="/../%E5%9B%BE%E7%89%87/image-20241021085159066.png" alt="image-20241021085159066"></p>
<p>通过这种方式就可以在hook其他app的时候主动调用自己写好的方法</p>
<h4 id="hook枚举类"><a href="#hook枚举类" class="headerlink" title="hook枚举类"></a>hook枚举类</h4><p>回忆一下枚举</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241021090808965.png" alt="image-20241021090808965"></p>
<p>hook枚举类没什么价值，可以直接看的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;com.xiaojianbang.app.Season&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">onMatch</span>: <span class="keyword">function</span> (<span class="params">obj</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="title function_">ordinal</span>());</span><br><span class="line">    &#125;, <span class="attr">onComplete</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.xiaojianbang.app.Season&quot;</span>).<span class="title function_">values</span>())</span><br></pre></td></tr></table></figure>

<p><img src="/../%E5%9B%BE%E7%89%87/image-20241021091445508.png" alt="image-20241021091445508"></p>
<h4 id="firda写文件"><a href="#firda写文件" class="headerlink" title="firda写文件"></a>firda写文件</h4><p>frida是有API支持文件写入的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">var</span> ios = <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/data/data/com.xiaojianbang.app/test.txt&quot;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">    ios.<span class="title function_">write</span>(<span class="string">&quot;Hello, world!\n&quot;</span>)</span><br><span class="line">    ios.<span class="title function_">flush</span>()</span><br><span class="line">    ios.<span class="title function_">close</span>()</span><br><span class="line"></span><br><span class="line">最好将文件路径写在当前包名下，否则容易没有写入权限</span><br><span class="line">w  覆盖</span><br><span class="line">a+ 追加</span><br><span class="line"></span><br><span class="line">注意：frida只有写文件的<span class="variable constant_">API</span>，没有读文件<span class="variable constant_">API</span>，如果要读文件，要去hook libc.<span class="property">so</span> 中的读文件的函数</span><br></pre></td></tr></table></figure>

<p><img src="/../%E5%9B%BE%E7%89%87/image-20241021093410843.png" alt="image-20241021093410843"></p>
<h4 id="转型-Java-cast"><a href="#转型-Java-cast" class="headerlink" title="转型 Java.cast"></a>转型 Java.cast</h4><p>进行向上或者向下转型，应对那种不能 toString() 的情况</p>
<p>之前也使用过这个东西，注意使用 cast 转型要是本来就是这个类型的才能转型</p>
<p>例如这个参数传进来的时候就进行了一个向上转型，在hook代码中向下转型是没什么问题的</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241021094753946.png" alt="image-20241021094753946"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var utils = Java.use(&quot;com.xiaojianbang.hook.Utils&quot;);</span><br><span class="line">utils.shufferMap2.implementation = function(map) &#123;</span><br><span class="line">	console.log(&quot;map: &quot; map);</span><br><span class="line">	var result = Java.cast(map, Java.use(&quot;java.util.HashMap&quot;));</span><br><span class="line">	console.log(&quot;map: &quot;， result);</span><br><span class="line">	return this.shufferMap2(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="数组的构建"><a href="#数组的构建" class="headerlink" title="数组的构建"></a>数组的构建</h4><p>这样也算是创建了一个数组</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241021100342745.png" alt="image-20241021100342745"></p>
<p>frida对于创建数组是专门提供了API的，array就是将JS数组转化为Java数组传到方法中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Utils</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.xiaojianbang.hook.Utils&quot;</span>);</span><br><span class="line"><span class="comment">// var obj =  Utils.myPrint([&quot;Hello&quot;, &quot;world&quot;, &quot;!&quot;])</span></span><br><span class="line"><span class="comment">// console.log(obj)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> strarr = <span class="title class_">Java</span>.<span class="title function_">array</span>(<span class="string">&quot;java.lang.String&quot;</span>, [<span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;world&quot;</span>, <span class="string">&quot;!&quot;</span>])</span><br><span class="line"><span class="keyword">var</span> obj =  <span class="title class_">Utils</span>.<span class="title function_">myPrint</span>(strarr)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj)</span><br></pre></td></tr></table></figure>

<p><img src="/../%E5%9B%BE%E7%89%87/image-20241021100657763.png" alt="image-20241021100657763"></p>
<h5 id="object数组的构建"><a href="#object数组的构建" class="headerlink" title="object数组的构建"></a>object数组的构建</h5><p><img src="/../%E5%9B%BE%E7%89%87/image-20241021174344517.png" alt="image-20241021174344517"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">可以看到传入的东西花里胡哨，有字符串，基本数据类型和对象</span><br><span class="line">这个时候就麻爪了，原因就是在<span class="title class_">Java</span>中万物皆对象，基本数据类型put到数组时是会转换成包装类，而js中没有这个操作，所以就报错了</span><br><span class="line">其实也是可以直接传的</span><br><span class="line">给他手动转换成包装类不就是了</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> money = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.xiaojianbang.hook.Money&quot;</span>).$new(<span class="string">&quot;demoMoney&quot;</span>, <span class="number">2000</span>);</span><br><span class="line">    <span class="keyword">var</span> bool = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Boolean&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> integer = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Integer&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> obj = <span class="title class_">Utils</span>.<span class="title function_">myPrint</span>([<span class="string">&quot;demo&quot;</span>, integer.$new(<span class="number">100</span>), bool.$new(<span class="literal">true</span>), money])</span><br></pre></td></tr></table></figure>

<p><img src="/../%E5%9B%BE%E7%89%87/image-20241021180237078.png" alt="image-20241021180237078"></p>
<p>只需要记住 Java.array 可以创建一个Java数组即可</p>
<h5 id="ArrayList主动调用"><a href="#ArrayList主动调用" class="headerlink" title="ArrayList主动调用"></a>ArrayList主动调用</h5><p>list是数组数据，map是键值对数据</p>
<p>原理和object一样的，都是基本数据类型要转换成包装类</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Utils</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.xiaojianbang.hook.Utils&quot;</span>);</span><br><span class="line">   <span class="comment">// var obj =  Utils.myPrint([&quot;Hello&quot;, &quot;world&quot;, &quot;!&quot;])</span></span><br><span class="line">   <span class="comment">// console.log(obj)</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// var strarr = Java.array(&quot;java.lang.String&quot;, [&quot;Hello&quot;, &quot;world&quot;, &quot;!&quot;])</span></span><br><span class="line">   <span class="comment">// var obj =  Utils.myPrint(strarr)</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> money = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.xiaojianbang.hook.Money&quot;</span>).$new(<span class="string">&quot;demoMoney&quot;</span>, <span class="number">2000</span>);</span><br><span class="line">   <span class="keyword">var</span> bool = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Boolean&quot;</span>);</span><br><span class="line">   <span class="keyword">var</span> integer = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Integer&quot;</span>);</span><br><span class="line"></span><br><span class="line">   <span class="comment">// var strarr = Java.array(&quot;Ljava.lang.Object;&quot;, [&quot;demo&quot;, integer.$new(100), bool.$new(true), money])</span></span><br><span class="line">   <span class="comment">// var obj =  Utils.myPrint(strarr)</span></span><br><span class="line">   <span class="keyword">var</span> obj = <span class="title class_">Utils</span>.<span class="title function_">myPrint</span>([<span class="string">&quot;demo&quot;</span>, integer.$new(<span class="number">100</span>), bool.$new(<span class="literal">true</span>), money])</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(obj)</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;==============================&quot;</span>)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> arraylist = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.util.ArrayList&quot;</span>).$new();</span><br><span class="line">   arraylist.<span class="title function_">add</span>(<span class="string">&quot;demo&quot;</span>);</span><br><span class="line">   arraylist.<span class="title function_">add</span>(integer.$new(<span class="number">100</span>));</span><br><span class="line">   arraylist.<span class="title function_">add</span>(bool.$new(<span class="literal">true</span>));</span><br><span class="line">   arraylist.<span class="title function_">add</span>(money);</span><br><span class="line">   <span class="keyword">var</span> obj1 = <span class="title class_">Utils</span>.<span class="title function_">myPrint</span>(arraylist)</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(obj1)</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;==============================&quot;</span>)</span><br></pre></td></tr></table></figure>



<p><img src="/../%E5%9B%BE%E7%89%87/image-20241021185206996.png" alt="image-20241021185206996"></p>
<h4 id="hook动态加载的dex"><a href="#hook动态加载的dex" class="headerlink" title="hook动态加载的dex"></a>hook动态加载的dex</h4><p>这个和枚举所有已加载的类长得很相似  <code>Java.enumerateLoadedClassesSync()</code> </p>
<p><code>Java.enumerateClassLoaders()</code>  这个是动态加载类</p>
<h5 id="提出问题"><a href="#提出问题" class="headerlink" title="提出问题"></a>提出问题</h5><p>报错提示没有找到 com.xiaojianbang.app.Dynamic 这个类</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241021190736252.png" alt="image-20241021190736252"></p>
<p>但是可以看到 com.xiaojianbang.app.Dynamic 这个类是已经加载了的，这个就和类加载器有关了，回旋镖转回来了，因为类加载器不同，所以没有找到这个类</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241021190636980.png" alt="image-20241021190636980"></p>
<h5 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// 获取所有的加载器</span></span><br><span class="line"><span class="title class_">Java</span>.<span class="title function_">enumerateClassLoaders</span>(&#123;</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 每有一个加载器，执行这个方法</span></span><br><span class="line">       <span class="attr">onMatch</span>: <span class="keyword">function</span> (<span class="params">loader</span>) &#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               <span class="comment">// 在这个加载器中去寻找 dynamic 这个类，找到了就执行这个类，没找打就打印这个加载器</span></span><br><span class="line">               <span class="title class_">Java</span>.<span class="property">classFactory</span>.<span class="property">loader</span> = loader;</span><br><span class="line">               <span class="keyword">var</span> dynamic = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.xiaojianbang.app.Dynamic&quot;</span>);</span><br><span class="line">               <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;dynamic: &quot;</span>, dynamic);</span><br><span class="line">               dynamic.<span class="property">sayHello</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hook sayHello called&quot;</span>);</span><br><span class="line">                   <span class="keyword">return</span> <span class="string">&quot;demo&quot;</span></span><br><span class="line">               &#125;</span><br><span class="line">           &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">               <span class="variable language_">console</span>.<span class="title function_">log</span>(loader);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;,</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 全部加载完毕执行这个方法</span></span><br><span class="line">       <span class="attr">onComplete</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;</span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure>



<p><img src="/../%E5%9B%BE%E7%89%87/image-20241021192603865.png" alt="image-20241021192603865"></p>
<p>动态加载：也可以理解成按需加载，就是在代码执行过程中加载dex文件，就比如 dynamic类，它不是classes.dex文件中的类，是apk执行过程中动态加载的一个类。hook动态加载类的时候就容易碰到，枚举类中有这个方法，但是hook说找不到这个方法。如果这个dex文件加密了，jadx也不会反编译出来这个类。</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241021193047976.png" alt="image-20241021193047976"></p>
<blockquote>
<p>Java.enumerateClassLoaders()这个API要安卓7以上才能使用</p>
</blockquote>
<h4 id="让hook只在指定函数内生效（了解）"><a href="#让hook只在指定函数内生效（了解）" class="headerlink" title="让hook只在指定函数内生效（了解）"></a>让hook只在指定函数内生效（了解）</h4><p>如果hook系统函数，调用很频繁的话是hook不成功的，直接崩溃了。</p>
<p>但是如果已经确定了范围，就可以用这种方式，其实也可以理解为hook嵌套</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mainActivity = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.xiaojianbang.app.MainActivity&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> stringBuilder = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.StringBuilder&quot;</span>)</span><br><span class="line">mainActivity.<span class="property">generateAESKey</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;mainActivity generateAESKey called&quot;</span>);</span><br><span class="line">    stringBuilder.<span class="property">toString</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="title function_">toString</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;generateAESKey result: &quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="property">generateAESKey</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">    stringBuilder.<span class="property">toString</span>.<span class="property">implementation</span> = <span class="literal">null</span>;  <span class="comment">// 取消hook</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<p><img src="/../%E5%9B%BE%E7%89%87/image-20241021194022869.png" alt="image-20241021194022869"></p>
<h4 id="hook定位接口-抽象类的实现类"><a href="#hook定位接口-抽象类的实现类" class="headerlink" title="hook定位接口\抽象类的实现类"></a>hook定位接口\抽象类的实现类</h4><h5 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h5><p>如果定位代码找到接口了，单纯的hook接口是没有什么东西的，我们要去找接口的实现类</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">var</span> classes = <span class="title class_">Java</span>.<span class="title function_">enumerateLoadedClassesSync</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 循环所有已经加载的类</span></span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">const</span> index <span class="keyword">in</span> classes) &#123;</span><br><span class="line">       <span class="keyword">let</span> className = classes[index];</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 过滤掉部分系统类</span></span><br><span class="line">       <span class="keyword">if</span> (className.<span class="title function_">indexOf</span>(<span class="string">&quot;com.xiaojianbang&quot;</span>) === -<span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// try一下防止有的类不在同一加载器，直接一个报错处理</span></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="keyword">let</span> clazz = <span class="title class_">Java</span>.<span class="title function_">use</span>(className);</span><br><span class="line">           </span><br><span class="line">           <span class="comment">// 获取接口数组</span></span><br><span class="line">           <span class="keyword">let</span> resultArr = clazz.<span class="property">class</span>.<span class="title function_">getInterfaces</span>();</span><br><span class="line">           <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;resultArr: &quot;</span>, resultArr);</span><br><span class="line">           <span class="keyword">if</span> (resultArr.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">           <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; resultArr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">               </span><br><span class="line">               <span class="comment">// 比对这个接口，打印这个数组</span></span><br><span class="line">               <span class="keyword">if</span> (resultArr[i].<span class="title function_">toString</span>().<span class="title function_">indexOf</span>(<span class="string">&quot;com.xiaojianbang.app.TestRegisterClass&quot;</span>) !== -<span class="number">1</span>) &#123;</span><br><span class="line">                   <span class="variable language_">console</span>.<span class="title function_">log</span>(className, resultArr);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">           <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Didn&#x27;t find class: &quot;</span> + className)</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<p>出了一点小bug，但是问题不大，还是得到了接口的实现类，对于不在同一个dex中的直接 try-catch 处理算了</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241022215523856.png" alt="image-20241022215523856"></p>
<h5 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h5><p>和接口的方法极其相似，但是牢弟你要知道接口可以实现多个，但是抽象类只能实现一个，因此 getSuperclass() 获取到的不是一个数组，所以不需要循环了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">var</span> classes = <span class="title class_">Java</span>.<span class="title function_">enumerateLoadedClassesSync</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 循环所有已经加载的类</span></span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">const</span> index <span class="keyword">in</span> classes) &#123;</span><br><span class="line">       <span class="keyword">let</span> className = classes[index];</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 过滤掉部分系统类</span></span><br><span class="line">       <span class="keyword">if</span> (className.<span class="title function_">indexOf</span>(<span class="string">&quot;com.xiaojianbang&quot;</span>) === -<span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// try一下防止有的类不在同一加载器，直接一个报错处理</span></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="keyword">let</span> clazz = <span class="title class_">Java</span>.<span class="title function_">use</span>(className);</span><br><span class="line">           </span><br><span class="line">           <span class="comment">// 获取抽象类</span></span><br><span class="line">           <span class="keyword">let</span> resultArr = clazz.<span class="property">class</span>.<span class="title function_">getSuperclass</span>();</span><br><span class="line">           <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;resultArr: &quot;</span>, className, resultArr);</span><br><span class="line">           <span class="keyword">if</span> (resultArr == <span class="literal">null</span>) <span class="keyword">continue</span>;</span><br><span class="line">           <span class="keyword">if</span> (resultArr[i].<span class="title function_">toString</span>().<span class="title function_">indexOf</span>(<span class="string">&quot;com.xiaojianbang.app.TestRegisterClass&quot;</span>) !== -<span class="number">1</span>) &#123;</span><br><span class="line">               <span class="variable language_">console</span>.<span class="title function_">log</span>(className, resultArr);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">           <span class="comment">// console.log(&quot;Didn&#x27;t find class: &quot; + className)</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<p><img src="/../%E5%9B%BE%E7%89%87/image-20241023110937621.png" alt="image-20241023110937621"></p>
<p>END</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%AE%89%E5%8D%93%E9%80%86%E5%90%91/" rel="tag"># 安卓逆向</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/10/15/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0-0x05-%E5%85%B3%E9%94%AE%E4%BB%A3%E7%A0%81%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D/" rel="prev" title="逆向学习 0x05关键代码快速定位">
      <i class="fa fa-chevron-left"></i> 逆向学习 0x05关键代码快速定位
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/10/24/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0-0x07%E5%85%8Droot%E4%BD%BF%E7%94%A8frida/" rel="next" title="逆向学习 0x07免root使用frida">
      逆向学习 0x07免root使用frida <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#API"><span class="nav-number">1.</span> <span class="nav-text">API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%E5%92%8C%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95%E7%9A%84hook"><span class="nav-number">1.1.</span> <span class="nav-text">静态方法和实例方法的hook</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E5%92%8C%E8%BF%94%E5%9B%9E%E5%80%BC%E7%9A%84%E4%BF%AE%E6%94%B9"><span class="nav-number">1.2.</span> <span class="nav-text">函数参数和返回值的修改</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95%E7%9A%84hook"><span class="nav-number">1.3.</span> <span class="nav-text">构造方法的hook</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1%E5%8F%82%E6%95%B0%E7%9A%84%E6%9E%84%E9%80%A0%E5%92%8C%E4%BF%AE%E6%94%B9"><span class="nav-number">1.4.</span> <span class="nav-text">对象参数的构造和修改</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HashMap%E7%9A%84%E6%89%93%E5%8D%B0"><span class="nav-number">1.5.</span> <span class="nav-text">HashMap的打印</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%87%8D%E8%BD%BD%E6%96%B9%E6%B3%95%E7%9A%84hook"><span class="nav-number">1.6.</span> <span class="nav-text">重载方法的hook</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8"><span class="nav-number">1.7.</span> <span class="nav-text">主动调用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%92%8C%E4%BF%AE%E6%94%B9%E7%B1%BB%E7%9A%84%E5%AD%97%E6%AE%B5"><span class="nav-number">1.8.</span> <span class="nav-text">获取和修改类的字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#hook%E5%86%85%E9%83%A8%E7%B1%BB%E5%92%8C%E5%8C%BF%E5%90%8D%E7%B1%BB"><span class="nav-number">1.9.</span> <span class="nav-text">hook内部类和匿名类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B7%B7%E6%B7%86%E5%87%BD%E6%95%B0%E7%9A%84hook%E6%96%B9%E6%B3%95"><span class="nav-number">1.10.</span> <span class="nav-text">混淆函数的hook方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9E%9A%E4%B8%BE%E6%89%80%E6%9C%89%E5%B7%B2%E5%8A%A0%E8%BD%BD%E7%9A%84%E7%B1%BB%E4%B8%8E%E6%9E%9A%E4%B8%BE%E7%B1%BB%E7%9A%84%E6%89%80%E6%9C%89%E6%96%B9%E6%B3%95"><span class="nav-number">1.11.</span> <span class="nav-text">枚举所有已加载的类与枚举类的所有方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#hook%E7%B1%BB%E7%9A%84%E6%89%80%E6%9C%89%E6%96%B9%E6%B3%95"><span class="nav-number">1.12.</span> <span class="nav-text">hook类的所有方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%A8%E5%85%A5dex"><span class="nav-number">1.13.</span> <span class="nav-text">注入dex</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Java-registerClass"><span class="nav-number">1.13.1.</span> <span class="nav-text">Java.registerClass</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#frida%E6%B3%A8%E5%85%A5dex"><span class="nav-number">1.13.2.</span> <span class="nav-text">frida注入dex</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#hook%E6%9E%9A%E4%B8%BE%E7%B1%BB"><span class="nav-number">1.14.</span> <span class="nav-text">hook枚举类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#firda%E5%86%99%E6%96%87%E4%BB%B6"><span class="nav-number">1.15.</span> <span class="nav-text">firda写文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BD%AC%E5%9E%8B-Java-cast"><span class="nav-number">1.16.</span> <span class="nav-text">转型 Java.cast</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E7%BB%84%E7%9A%84%E6%9E%84%E5%BB%BA"><span class="nav-number">1.17.</span> <span class="nav-text">数组的构建</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#object%E6%95%B0%E7%BB%84%E7%9A%84%E6%9E%84%E5%BB%BA"><span class="nav-number">1.17.1.</span> <span class="nav-text">object数组的构建</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ArrayList%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8"><span class="nav-number">1.17.2.</span> <span class="nav-text">ArrayList主动调用</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#hook%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E7%9A%84dex"><span class="nav-number">1.18.</span> <span class="nav-text">hook动态加载的dex</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8F%90%E5%87%BA%E9%97%AE%E9%A2%98"><span class="nav-number">1.18.1.</span> <span class="nav-text">提出问题</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95"><span class="nav-number">1.18.2.</span> <span class="nav-text">解决方法</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%A9hook%E5%8F%AA%E5%9C%A8%E6%8C%87%E5%AE%9A%E5%87%BD%E6%95%B0%E5%86%85%E7%94%9F%E6%95%88%EF%BC%88%E4%BA%86%E8%A7%A3%EF%BC%89"><span class="nav-number">1.19.</span> <span class="nav-text">让hook只在指定函数内生效（了解）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#hook%E5%AE%9A%E4%BD%8D%E6%8E%A5%E5%8F%A3-%E6%8A%BD%E8%B1%A1%E7%B1%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="nav-number">1.20.</span> <span class="nav-text">hook定位接口\抽象类的实现类</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8E%A5%E5%8F%A3"><span class="nav-number">1.20.1.</span> <span class="nav-text">接口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E7%B1%BB"><span class="nav-number">1.20.2.</span> <span class="nav-text">抽象类</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="没事数命的猫"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">没事数命的猫</p>
  <div class="site-description" itemprop="description">学而不思则罔</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">26</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">没事数命的猫</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">151k</span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

-->

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>

<!-- 点击效果 -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript" src="/js/love-click.js"></script>