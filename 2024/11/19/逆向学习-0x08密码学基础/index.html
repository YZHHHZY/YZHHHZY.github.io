<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/%E5%8D%9A%E5%AE%A2.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/%E5%8D%9A%E5%AE%A2-copy.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="密码学概要： 在逆向中，非常有必要了解一下密码学，在逆向过程中，有些参数不知道来源，可能是随机生成、标准算法、自写算法加密 在安卓中，标准算法加密通常会 出现在Java、so(C\C++)、JS中 对于标准算法，Java中有现成的API调用，如果要使用这些API就需要使用指定的方法，就有了hook的机会，这些前面已经操作过了">
<meta property="og:type" content="article">
<meta property="og:title" content="逆向学习 0x08密码学基础">
<meta property="og:url" content="http://example.com/2024/11/19/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0-0x08%E5%AF%86%E7%A0%81%E5%AD%A6%E5%9F%BA%E7%A1%80/index.html">
<meta property="og:site_name" content="妙妙屋">
<meta property="og:description" content="密码学概要： 在逆向中，非常有必要了解一下密码学，在逆向过程中，有些参数不知道来源，可能是随机生成、标准算法、自写算法加密 在安卓中，标准算法加密通常会 出现在Java、so(C\C++)、JS中 对于标准算法，Java中有现成的API调用，如果要使用这些API就需要使用指定的方法，就有了hook的机会，这些前面已经操作过了">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241102162750820.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241102164435629.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241102164619306.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241102164936217.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241102165507956.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241102165834207.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241102171105422.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241102171451165.png">
<meta property="og:image" content="http://example.com/2024/11/19/%E5%9B%BE%E7%89%87/image-20241102174147974.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241102181035429.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241105193154873.png">
<meta property="og:image" content="http://example.com/2024/11/19/%E5%9B%BE%E7%89%87/image-20241105210941137.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241105211506561.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241106184835852.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241106193133857.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241106200233800.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241106200618601.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241106203420408.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241107122725336.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241107135559234.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241114213144356.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241116115653290.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241117195958891.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241118163848199.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241117205858280.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241117211621418.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241117212032481.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241117212918100.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241118164530869.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241118165839649.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241118184812571.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241118185931951.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241118195155371.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241118195128484.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241118195326505.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241118195526753.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241118195657998.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241118201358518-1732016006152-1.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241118201651343-1732016006152-2.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241118202056572-1732016006153-3.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241118202319995-1732016006153-4.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241118202631605-1732016006153-5.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241118210735767-1732016006153-6.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241119145222944-1732016006153-7.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241118211817786-1732016006153-8.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241119144624973-1732016006153-9.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241119145500510-1732016006153-10.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241119153831614-1732016006153-11.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241119154429072-1732016006153-12.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241119165204122-1732016006153-13.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241119165810685-1732016006153-14.png">
<meta property="article:published_time" content="2024-11-19T11:00:09.000Z">
<meta property="article:modified_time" content="2025-03-13T09:36:01.160Z">
<meta property="article:author" content="没事数命的猫">
<meta property="article:tag" content="安卓逆向">
<meta property="article:tag" content="密码学">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/%E5%9B%BE%E7%89%87/image-20241102162750820.png">

<link rel="canonical" href="http://example.com/2024/11/19/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0-0x08%E5%AF%86%E7%A0%81%E5%AD%A6%E5%9F%BA%E7%A1%80/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>逆向学习 0x08密码学基础 | 妙妙屋</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">妙妙屋</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">思而不学则殆</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/19/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0-0x08%E5%AF%86%E7%A0%81%E5%AD%A6%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="没事数命的猫">
      <meta itemprop="description" content="学而不思则罔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="妙妙屋">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          逆向学习 0x08密码学基础
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-11-19 19:00:09" itemprop="dateCreated datePublished" datetime="2024-11-19T19:00:09+08:00">2024-11-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-13 17:36:01" itemprop="dateModified" datetime="2025-03-13T17:36:01+08:00">2025-03-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">逆向学习</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>12k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>45 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="密码学"><a href="#密码学" class="headerlink" title="密码学"></a>密码学</h1><p>概要：</p>
<p>在逆向中，非常有必要了解一下密码学，在逆向过程中，有些参数不知道来源，可能是随机生成、标准算法、自写算法加密</p>
<p>在安卓中，标准算法加密通常会 出现在Java、so(C\C++)、JS中</p>
<p>对于标准算法，Java中有现成的API调用，如果要使用这些API就需要使用指定的方法，就有了hook的机会，这些前面已经操作过了</p>
<span id="more"></span>

<p>C\C++中没有现成的系统API调用，开发者要么自己去实现算法，要么调用别人写好的模块，算法的运行就不依靠系统API，因此这些方法名可以进行混淆。我们需要根据各种标准算法的特征，去识别是否为标准算法</p>
<p>JS中没有系统API但是有知名的第三方库：CryptoJS、jsencrypt等</p>
<blockquote>
<p>常见的算法：</p>
<p>​	信息摘要算法（散列函数、哈希函数）</p>
<p>​		MD5、SHA、MAC</p>
<p>​	对称加密算法</p>
<p>​		DES、3DES、AES</p>
<p>​	非对称加密算法</p>
<p>​		RSA</p>
<p>​	数字签名算法</p>
<p>​		MD5withRSA、SHA1withRSA、SHA256withRSA</p>
</blockquote>
<h3 id="H5的app逆向"><a href="#H5的app逆向" class="headerlink" title="H5的app逆向"></a>H5的app逆向</h3><p>使用前面提到过的查看app界面控件的小东西，看一下</p>
<p>这个页面只有框架，这个就是将一个网页做的像app登录的页面，然后放到这个框架里</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241102162750820.png" alt="image-20241102162750820"></p>
<blockquote>
<p>那么这个时候的逆向思路是什么呢</p>
<p>1、H5的核心代码通常在JS文件中</p>
<p>​		远程调试、修改JS代码注入代码</p>
<p>2、WebView远程调试</p>
<p>​	注意：a. 手机端的WebView版本要比电脑端的chrome版本低</p>
<p>​			   b. 手机端的WebView要开启可调式</p>
<p>​		 	  c. 需要VPN，因为点击inspect时要下载一些东西</p>
<p>​			   d. 通常app中的WebView是不可调试的，需要hook来开启调试</p>
</blockquote>
<h3 id="WebView调试准备"><a href="#WebView调试准备" class="headerlink" title="WebView调试准备"></a>WebView调试准备</h3><p>上面有四条了，chrome访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome://inspect</span><br></pre></td></tr></table></figure>

<p>可以看到是有设备的一些信息的 </p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241102164435629.png" alt="image-20241102164435629"></p>
<p>在手机中尝试随便访问一个网站，然后刷新chrome页面，是可以看到有页面情况的</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241102164619306.png" alt="image-20241102164619306"></p>
<p>也是有webView的，而且为啥拿百度呢，因为百度是开启了webview调试的</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241102164936217.png" alt="image-20241102164936217"></p>
<p>点击chrome中的inspect就可以进入谷歌的开发者工具，可以打断点，调试什么的，剩下的就交给JS逆向了</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241102165507956.png" alt="image-20241102165507956"></p>
<p>再回头来看怎么开启WebView调试</p>
<p>不开启调试是获取不到东西的</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241102165834207.png" alt="image-20241102165834207"></p>
<p>hook掉WebView方法，设置为开启调试状态</p>
<p>代码hook了所有的构造方法，在构造方法中设置开启调试，再hook掉开启方法，始终保持为true</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">WebView</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;android.webkit.WebView&#x27;</span>);</span><br><span class="line">    <span class="title class_">WebView</span>.<span class="property">$init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;android.content.Context&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">a</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;WebView.$init is called!&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> retval = <span class="variable language_">this</span>.$init(a);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setWebContentsDebuggingEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> retval;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">WebView</span>.<span class="property">$init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;android.content.Context&#x27;</span>, <span class="string">&#x27;android.util.AttributeSet&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">a, b</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;WebView.$init is called!&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> retval = <span class="variable language_">this</span>.$init(a, b);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setWebContentsDebuggingEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> retval;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">WebView</span>.<span class="property">$init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;android.content.Context&#x27;</span>, <span class="string">&#x27;android.util.AttributeSet&#x27;</span>, <span class="string">&#x27;int&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">a, b, c</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;WebView.$init is called!&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> retval = <span class="variable language_">this</span>.$init(a, b, c);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setWebContentsDebuggingEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> retval;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">WebView</span>.<span class="property">$init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;android.content.Context&#x27;</span>, <span class="string">&#x27;android.util.AttributeSet&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;boolean&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">a, b, c, d</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;WebView.$init is called!&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> retval = <span class="variable language_">this</span>.$init(a, b, c, d);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setWebContentsDebuggingEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> retval;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">WebView</span>.<span class="property">$init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;android.content.Context&#x27;</span>, <span class="string">&#x27;android.util.AttributeSet&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;int&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">a, b, c, d</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;WebView.$init is called!&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> retval = <span class="variable language_">this</span>.$init(a, b, c, d);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setWebContentsDebuggingEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> retval;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">WebView</span>.<span class="property">$init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;android.content.Context&#x27;</span>, <span class="string">&#x27;android.util.AttributeSet&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;java.util.Map&#x27;</span>, <span class="string">&#x27;boolean&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">a, b, c, d, e</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;WebView.$init is called!&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> retval = <span class="variable language_">this</span>.$init(a, b, c, d, e);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setWebContentsDebuggingEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> retval;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">WebView</span>.<span class="property">$init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;android.content.Context&#x27;</span>, <span class="string">&#x27;android.util.AttributeSet&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;java.util.Map&#x27;</span>, <span class="string">&#x27;boolean&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">a, b, c, d, e, f</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;WebView.$init is called!&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> retval = <span class="variable language_">this</span>.$init(a, b, c, d, e, f);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setWebContentsDebuggingEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> retval;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title class_">WebView</span>.<span class="property">setWebContentsDebuggingEnabled</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setWebContentsDebuggingEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setWebContentsDebuggingEnabled is called!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>将这个脚本重启附加到app中</p>
<p>必须要重启不能附加，因为页面都构建完成了，时机过去了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -U -f com.zngst.app -l hook_webview.js</span><br></pre></td></tr></table></figure>



<p>这个时候就成功了</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241102171105422.png" alt="image-20241102171105422"></p>
<p>登录以下是，抓个包</p>
<p>从这里可以跳转到登录有关的方法，跳转，打断点就不展示了</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241102171451165.png" alt="image-20241102171451165"></p>
<blockquote>
<p>H5的app也分很多种</p>
<p>​	1、纯JS发包，这个时候可以在远程调试工具上抓到包，也有相应JS代码</p>
<p>​	2、部分JS发包，部分Java发包，这个时候有些包可以在调试工具上抓到，有些不行，需要分析</p>
<p>​			比如：Java和JS的相互调用，从这个角度入手，找Java里面的接口。</p>
<p>​	3、纯Java发包，典型的就是uni-app，但是uni-app核心代码是在JS中，因为就是用JS写的。这个就牛逼了。发包在Java中，谷歌中看不到代码，这个时候远程调试就没啥用了。只能修改JS代码注入代码。对uni-app感兴趣可以下载一个HBuilderX耍一下</p>
</blockquote>
<h2 id="HEX编码"><a href="#HEX编码" class="headerlink" title="HEX编码"></a>HEX编码</h2><p>闲话少扯，看密码学内容，H5的app弄到调试的位置剩下的就和JS逆向差不多了</p>
<blockquote>
<p>概述：</p>
<p>​	HEX编码是一种用16进制字符表示任意二进制数据的方法</p>
<p>​	是一种编码，不存在加密</p>
</blockquote>
<p>一个字节的范围是 0-255 ，hex编码用两个16进制字符表示这个一个字节</p>
<p>第一个F就代表了二进制中前四个比特位 <code>1111</code> 。也就是说十六进制中的一个十六进制字符占四个比特位，半个字节。两个十六进制字符，就可以表示八个比特位一个字节的数据。</p>
<img src="../图片/image-20241102174147974.png" alt="image-20241102174147974" style="zoom: 67%;" />



<blockquote>
<p>注意和字符编码区分开来：</p>
<p>​	字符编码有 ASCII、UTF-8、GBK</p>
<p>​	字符编码说白了是一种映射规则，将字符映射到唯一一种状态（二进制字符串），这个就是编码。也就是说如果没有字符编码来表示特定二进制的意思，那我们就只能读0101101这样的01字符串了</p>
<p>USC2、URL和HEX差不多是一种编码方式</p>
</blockquote>
<h3 id="hex编码的代码实现及码表"><a href="#hex编码的代码实现及码表" class="headerlink" title="hex编码的代码实现及码表"></a>hex编码的代码实现及码表</h3><p>这个是一个针对字符串的实现，还有char的</p>
<p>是用函数将字符串转换成二进制，然后转换成16进制的表示方式</p>
<p>char数组直接转换</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241102181035429.png" alt="image-20241102181035429"></p>
<p>不够底层，看一下Java第三方库的一个处理方法</p>
<p>看注释</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">hex</span><span class="params">(data)</span> &#123;</span><br><span class="line">    <span class="comment">// 码表</span></span><br><span class="line">    <span class="type">char</span>[] HEX_DIGITS = &#123;<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>&#125;</span><br><span class="line">	<span class="comment">// 创建char数组，长度为明文字节的长度 * 2，因为两个十六进制字符才能表示一个字节信息</span></span><br><span class="line">    <span class="type">char</span>[] result = <span class="keyword">new</span> <span class="title class_">char</span>[data.length * <span class="number">2</span>];</span><br><span class="line">	<span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 取出字节，挨个处理</span></span><br><span class="line">	<span class="keyword">for</span>(<span class="type">byte</span> b: data) &#123;</span><br><span class="line">        <span class="comment">// 先将二进制数据右移四位</span></span><br><span class="line">        <span class="comment">// 比如： 1111 1111</span></span><br><span class="line">        <span class="comment">// 右移： 0000 1111 1111</span></span><br><span class="line">        <span class="comment">// 结果后面的四个字符被舍去为：0000 1111</span></span><br><span class="line">        <span class="comment">// 然后进行 &amp; 操纵，只有两个都为1才是1，0xf的值为0000 1111</span></span><br><span class="line">        <span class="comment">// 比如：1010 1111 右移四位 0000 1010</span></span><br><span class="line">        <span class="comment">// &amp; 操作之后的结果为 0000 1010 ，成功取出前四位</span></span><br><span class="line">        result[c++] = HEX_DIGITS[(b &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xf</span>];</span><br><span class="line">        <span class="comment">// 再进行 &amp; 操作 1010 1111 和 0000 1111</span></span><br><span class="line">        <span class="comment">// 结果为 0000 1111 ，成功取出后四位</span></span><br><span class="line">        result[c++] = HEX_DIGITS[b &amp; <span class="number">0xf</span>];</span><br><span class="line">        <span class="comment">// 利用这样的操作，两个代码，第一行获取高四位，第二行获取低四位。来转换成HEX编码</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(result)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 写一个小小的注释，这个中括号内传入的是二进制数据，就会根据二进制找到对应的索引</span></span><br></pre></td></tr></table></figure>



<p>光看这个hex编码有点无聊，思路打开，为什么码表一定要0-9+a-f呢，将码表改一下，那就是一个非标准的hex编码。这个时候就需要找到这个码表了</p>
<blockquote>
<p>hex编码的特点：</p>
<p>​	1、用0-9 a-f 十六个字符表示</p>
<p>​	2、每个十六进制字符代表4bit，也就是2个十六进制字符代表一个字节</p>
<p>​	3、在实际的应用中，比如密钥初始化，一定要分清楚传进去的密钥是哪种编码，采用对应的方式解析，才能得到对应的密钥</p>
<p>​	4、编程中的很多问题，需要从字节甚至二进制位的角度去考虑</p>
</blockquote>
<h2 id="Base64编码"><a href="#Base64编码" class="headerlink" title="Base64编码"></a>Base64编码</h2><blockquote>
<p>用64个字符表示任意二进制数据的方法</p>
<p>base64是一种编码，而非加密</p>
<p>64个字符表示256种情况。和hex编码不同，hex编码是16*16正好为256，所以正好可以将一个字节拆开，用两个十六进制字符表示。一个十六进制字符占4bit</p>
<p>与hex不同的是base64编码的一个字符占6bit，用四个字符表示三个字节 6*4&#x3D;8*3</p>
<p>base64使用的字符为 A-Z a-z 0-9 + &#x2F; &#x3D;</p>
<p>实际使用的是65个，最后的等号是用来补位填充的，看上面的表示方式应该也能理解为啥需要补位吧</p>
</blockquote>
<p>base64的应用比较光，比如RSA密钥、加密后的密文、图片等数据，会有一些不可见的字符，直接转成文本传输的话，会有乱码、数据错误、数据丢失等情况，就需要用到base64编码</p>
<p>瞅一下实现代码</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241105193154873.png" alt="image-20241105193154873"></p>
<p>大致了解一下这个处理过程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个方法，作用于 ByteArray 类型，它接受一个可选参数 map</span></span><br><span class="line"><span class="comment">// 参数的默认值为BASE64，这个是BASE64编码的字典</span></span><br><span class="line"><span class="comment">// internal val BASE64 =</span></span><br><span class="line"><span class="comment">//   &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;.encodeUtf8().data</span></span><br><span class="line">internal fun ByteArray.encodeBase64(map: ByteArray = BASE64): String &#123;</span><br><span class="line">    <span class="comment">// 因为base64四位字符表示三个字节，+2是防止数据丢失</span></span><br><span class="line">	<span class="type">val</span> <span class="variable">length</span> <span class="operator">=</span> (size + <span class="number">2</span>) / <span class="number">3</span> * <span class="number">4</span></span><br><span class="line">    <span class="comment">// 创建新字节数组，来存储编码后的结果</span></span><br><span class="line">	<span class="type">val</span> <span class="variable">out</span> <span class="operator">=</span> ByteArray(length)</span><br><span class="line">    <span class="comment">// 定义索引</span></span><br><span class="line">	<span class="type">var</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="comment">// 因为之前无脑+2了，这里处理一下结束位置，避免不必要的补位</span></span><br><span class="line">	<span class="type">val</span> <span class="variable">end</span> <span class="operator">=</span> size - size % <span class="number">3</span></span><br><span class="line">	<span class="type">var</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="comment">// 遍历数组</span></span><br><span class="line">	<span class="keyword">while</span> (i &lt; end) &#123;</span><br><span class="line">        <span class="comment">// 先读取前三个字节的二进制数据，转换成int类型</span></span><br><span class="line">    	<span class="type">val</span> <span class="variable">b0</span> <span class="operator">=</span> <span class="built_in">this</span>[i++].toInt()</span><br><span class="line">    	<span class="type">val</span> <span class="variable">b1</span> <span class="operator">=</span> <span class="built_in">this</span>[i++].toInt()</span><br><span class="line">    	<span class="type">val</span> <span class="variable">b2</span> <span class="operator">=</span> <span class="built_in">this</span>[i++].toInt()</span><br><span class="line">            </span><br><span class="line">        <span class="comment">// 截取b0 的前六位数据，b0 的后两位和 b1 的前四位，b1 的后四位和 b2 的前两位，b2 的后六位</span></span><br><span class="line">    	out[index++] = map[(b0 and <span class="number">0xff</span> shr <span class="number">2</span>)]</span><br><span class="line">    	out[index++] = map[(b0 and <span class="number">0x03</span> shl <span class="number">4</span>) or (b1 and <span class="number">0xff</span> shr <span class="number">4</span>)]</span><br><span class="line">    	out[index++] = map[(b1 and <span class="number">0x0f</span> shl <span class="number">2</span>) or (b2 and <span class="number">0xff</span> shr <span class="number">6</span>)]</span><br><span class="line">    	out[index++] = map[(b2 and <span class="number">0x3f</span>)]</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 判断是否有剩余字节长度，如果有进入when</span></span><br><span class="line">	when (size - end) &#123;</span><br><span class="line">        <span class="comment">// 如果剩一个字节</span></span><br><span class="line">		<span class="number">1</span> -&gt; &#123;</span><br><span class="line">            <span class="comment">// 用两位base64字符读取这一个字节，再来两位字符“==”补位</span></span><br><span class="line">			<span class="type">val</span> <span class="variable">b0</span> <span class="operator">=</span> <span class="built_in">this</span>[i].toInt()</span><br><span class="line">			out[index++] = map[b0 and <span class="number">0xff</span> shr <span class="number">2</span>]</span><br><span class="line">			out[index++] = map[b0 and <span class="number">0x03</span> shl <span class="number">4</span>]</span><br><span class="line">			out[index++] = <span class="string">&#x27;=&#x27;</span>.code.toByte()</span><br><span class="line">			out[index] = <span class="string">&#x27;=&#x27;</span>.code.toByte()</span><br><span class="line">		&#125;</span><br><span class="line">        <span class="comment">// 如果剩两个字节</span></span><br><span class="line">		<span class="number">2</span> -&gt; &#123;</span><br><span class="line">            <span class="comment">// 用三位base64字符读取剩余的两个字节，再使用一个“=”补位</span></span><br><span class="line">			<span class="type">val</span> <span class="variable">b0</span> <span class="operator">=</span> <span class="built_in">this</span>[i++].toInt()</span><br><span class="line">			<span class="type">val</span> <span class="variable">b1</span> <span class="operator">=</span> <span class="built_in">this</span>[i].toInt()</span><br><span class="line">			out[index++] = map[(b0 and <span class="number">0xff</span> shr <span class="number">2</span>)]</span><br><span class="line">			out[index++] = map[(b0 and <span class="number">0x03</span> shl <span class="number">4</span>) or (b1 and <span class="number">0xff</span> shr <span class="number">4</span>)]</span><br><span class="line">			out[index++] = map[(b1 and <span class="number">0x0f</span> shl <span class="number">2</span>)]</span><br><span class="line">			out[index] = <span class="string">&#x27;=&#x27;</span>.code.toByte()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">// 返回处理好的数据</span></span><br><span class="line">	<span class="keyword">return</span> out.toUtf8String()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>它其实还有一套码表，是BASE64_URL_SAFE</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">internal <span class="type">val</span> <span class="variable">BASE64_URL_SAFE</span> <span class="operator">=</span></span><br><span class="line"><span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_&quot;</span>.encodeUtf8().data</span><br></pre></td></tr></table></figure>

<p>看名字就知道用途了，如果用于url编码，+就变为空格了，数据就出大问题，所以就需要把+&#x2F;给替换掉，就换成了-_，这样一替换就不需要再进行url编码了</p>
</blockquote>
<p>再了解一下核心科技，转换字符部分</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 比如进去的三个字节为 e f g</span></span><br><span class="line"><span class="comment">// toInt是将字节根据ASCII码表将其转化为数字</span></span><br><span class="line"><span class="type">val</span> <span class="variable">b0</span> <span class="operator">=</span> <span class="built_in">this</span>[i++].toInt()	<span class="comment">// 101</span></span><br><span class="line"><span class="type">val</span> <span class="variable">b1</span> <span class="operator">=</span> <span class="built_in">this</span>[i++].toInt()	<span class="comment">// 102</span></span><br><span class="line"><span class="type">val</span> <span class="variable">b2</span> <span class="operator">=</span> <span class="built_in">this</span>[i++].toInt()	<span class="comment">// 103</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 101 的二进制 0110 0101 和1111 1111 进行 &amp; 操作，结果不变再进行shr 2的操作，得到结果 0001 1001（25=&#x27;Z&#x27;）</span></span><br><span class="line">out[index++] = map[(b0 and <span class="number">0xff</span> shr <span class="number">2</span>)]</span><br><span class="line"><span class="comment">// 将 0110 0101 和 0000 0011 进行 &amp; 操作，得到01</span></span><br><span class="line"><span class="comment">// 再将 0110 0110 和 1111 1111 进行 &amp; 操作，结果不变，再右移四位 0000 0110。合并这两部分 0001 0110（22=&#x27;W&#x27;）</span></span><br><span class="line">out[index++] = map[(b0 and <span class="number">0x03</span> shl <span class="number">4</span>) or (b1 and <span class="number">0xff</span> shr <span class="number">4</span>)]</span><br><span class="line"><span class="comment">// 将 0110 0110 和 0000 1111 &amp; 操作，得到 0000 0110， 再从取 0110 0111 的前两位，组成 0001 1001（25=&#x27;Z&#x27;）</span></span><br><span class="line">out[index++] = map[(b1 and <span class="number">0x0f</span> shl <span class="number">2</span>) or (b2 and <span class="number">0xff</span> shr <span class="number">6</span>)]</span><br><span class="line"><span class="comment">// 得到最后的六个 0010 0111（39=&#x27;n&#x27;）</span></span><br><span class="line">out[index++] = map[(b2 and <span class="number">0x3f</span>)]</span><br><span class="line">    </span><br><span class="line"><span class="comment">// efg的base64编码结果为ZWZn</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>base64编码的特点</p>
<p>​	1、Base64编码是一种编码，编码后会增加字节数</p>
<p>​	2、算法可逆，解码很方便，不用于私密信息通信</p>
<p>​	3、标准的Base64每行76个字符，行末添加换行符（这个需要注意，在拿到base64字符串进行解密操作的时候，一定不要忘了加上换行符）</p>
<p>​	4、加密后的字符串只有65种字符，不可打印的字符也能传输</p>
<p>​	5、在Java层可以通过hook对应的方法名来快速定位关键代码</p>
<p>​	6、在so层可以通过输入输出的数据和码表来确定算法</p>
</blockquote>
<h3 id="工具函数封装"><a href="#工具函数封装" class="headerlink" title="工具函数封装"></a>工具函数封装</h3><p>使用安卓的一个API，ByteString将byte数组转换成对应的hex编码或者base64编码，方便数据的查找和显示</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">ByteString</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.android.okhttp.okio.ByteString&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">toBase64</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(tag + <span class="string">&quot;Base64：&quot;</span> + <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">base64</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">toHex</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(tag + <span class="string">&quot;hex：&quot;</span> + <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">hex</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">toUtf8</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(tag + <span class="string">&quot;Utf8：&quot;</span> + <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">utf8</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





<h2 id="信息摘要算法"><a href="#信息摘要算法" class="headerlink" title="信息摘要算法"></a>信息摘要算法</h2><blockquote>
<p>特点：</p>
<p>​	1、不同长度的输入，产生固定长度的输出</p>
<p>​	2、信息摘要算法&#x2F;单向散列函数&#x2F;哈希函数</p>
<p>​	3、散列后的密文不可逆</p>
<p>​	4、散列后的结果唯一</p>
<p>​	5、哈希碰撞</p>
<p>​	6、一般用于校验数据完整性、签名sign</p>
<p>​			由于密文不可逆，所以服务端也无法解密</p>
<p>​			想要验证，只能跟前端一样再重新验证、计算签名</p>
<p>​			签名算法一般会把源数据和签名后的值一起提交到数据段</p>
<p>​			要保证在签名的时候的数据和提交上去的源数据一致</p>
<p>常见算法：MD5、SHA1、SHA256、SHA512、HmacMD5、HmacSHA1、HmacSHA256、HmacSHA512、RIPEMD160、HmacRIPEMD160、PBKDF2、EvpKDF</p>
<p>根据密文不可逆就可以推测出，签名的明文一定在数据包内，让服务端知道，否则服务端无法验证密文真伪</p>
</blockquote>
<p>之前在Java层逆向的时候，小记了一下如何区分签名算法</p>
<img src="../图片/image-20241105210941137.png" alt="image-20241105210941137"  />



<p>SHA-0已经废弃了，SHA-3虽然2011发布，但是不常见，常见的是MD5、SHA-1、SHA-256，这个256是SHA-2的256，SHA-2的256和SHA-3的256算出来的结果是不一样的</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241105211506561.png" alt="image-20241105211506561"></p>
<blockquote>
<p>输出散列值长度是输出的结果占的字节数，比如MD5占128个字节</p>
<p>资料区块长度是算法进行分组摘要，如MD5每组分512bit</p>
<p>哈希碰撞：即出现不同的信息算出的MD5相同的情况，所以现在很多都使用SHA-256进行签名，虽然哈希碰撞的概率很小，但是是客观存在的</p>
</blockquote>
<h3 id="MD5"><a href="#MD5" class="headerlink" title="MD5"></a>MD5</h3><p>MD5的Java实现，想要实现MD5很简单，因为Java已经写好这个底层了，直接拿来主义就好</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 先获取到MD5的对象</span></span><br><span class="line"><span class="type">MessageDigest</span> <span class="variable">md5</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line"><span class="comment">// 使用 .update 进行加密操作，注意传进去的要是byte数组</span></span><br><span class="line">md5.update(<span class="string">&quot;demo&quot;</span>.getBytes());</span><br><span class="line"><span class="comment">// 返回的结果也需要byte数组接收</span></span><br><span class="line"><span class="type">byte</span>[] bytes = md5.digest();</span><br><span class="line"><span class="comment">// 想要打印结果再将byte数组使用hex或者base64编码一下即可</span></span><br></pre></td></tr></table></figure>



<h4 id="算法加盐"><a href="#算法加盐" class="headerlink" title="算法加盐"></a>算法加盐</h4><p>通俗点来说就是在明文前&#x2F;后加上一段固定的字符串，来计算MD5，想要获取盐值也很简单，传一个空的得到MD5去网站上，爆破一下就好了</p>
<p><a target="_blank" rel="noopener" href="https://www.cmd5.com/">https://www.cmd5.com/</a></p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241106184835852.png" alt="image-20241106184835852"></p>
<h3 id="SHA"><a href="#SHA" class="headerlink" title="SHA"></a>SHA</h3><p>SHA的Java实现</p>
<p>和MD5的方法几乎一模一样，就是把传进去的名字改一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 先获取到SHA-1的对象</span></span><br><span class="line"><span class="type">MessageDigest</span> <span class="variable">sha1</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;SHA-1&quot;</span>);</span><br><span class="line"><span class="comment">// 使用 .update 进行加密操作，注意传进去的要是byte数组</span></span><br><span class="line">sha1.update(<span class="string">&quot;demo&quot;</span>.getBytes());</span><br><span class="line"><span class="comment">// 返回的结果也需要byte数组接收</span></span><br><span class="line"><span class="type">byte</span>[] bytes = sha1.digest();</span><br><span class="line"><span class="comment">// 想要打印结果再将byte数组使用hex或者base64编码一下即可</span></span><br></pre></td></tr></table></figure>





<h3 id="算法通杀"><a href="#算法通杀" class="headerlink" title="算法通杀"></a>算法通杀</h3><p>所谓的通杀也只是hook标准算法需要走的Java层一些函数，如果不走这个函数也杀不掉，如果不是标准算法更杀不掉</p>
<h4 id="MD5的hook"><a href="#MD5的hook" class="headerlink" title="MD5的hook"></a>MD5的hook</h4><p>将之前的工具函数和打印堆栈先拿过来</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">showStacks</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">        	<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.util.Log&quot;</span>)</span><br><span class="line">            	.<span class="title function_">getStackTraceString</span>(</span><br><span class="line">                	<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Throwable&quot;</span>).$new()</span><br><span class="line">                )</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">ByteString</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.android.okhttp.okio.ByteString&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">toBase64</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(tag + <span class="string">&quot;Base64：&quot;</span> + <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">base64</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">toHex</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(tag + <span class="string">&quot;hex：&quot;</span> + <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">hex</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">toUtf8</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(tag + <span class="string">&quot;Utf8：&quot;</span> + <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">utf8</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>如果要hook安卓的md5，根据上方的实现代码，有两个方法需要hook，一个是 update 另一个是 digest，因为 digest 也是可以传明文数值的</p>
<p>update这个方法在 java.security 包下的 MessageDigest 类中，有很多重载方法</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241106193133857.png" alt="image-20241106193133857"></p>
<p>hook update方法</p>
<p>因为加密的数据可能不是明文，而是乱码，这个时候就需要之前的工具函数来进行转换显示</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> messageDigest = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.security.MessageDigest&quot;</span>)</span><br><span class="line">messageDigest.<span class="property">update</span>.<span class="title function_">overload</span>(<span class="string">&#x27;byte&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;MessageDigest update(&#x27;byte&#x27;): &quot;</span> + data);</span><br><span class="line">    <span class="title function_">showStacks</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(data);</span><br><span class="line">&#125;</span><br><span class="line">messageDigest.<span class="property">update</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.nio.ByteBuffer&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;MessageDigest update(&#x27;java.nio.ByteBuffer&#x27;): &quot;</span> + data);</span><br><span class="line">    <span class="title function_">showStacks</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意下面的这两个是比较常用到的</span></span><br><span class="line">messageDigest.<span class="property">update</span>.<span class="title function_">overload</span>(<span class="string">&#x27;[B&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;MessageDigest update(&#x27;[B&#x27;)&quot;</span>);</span><br><span class="line">    <span class="title function_">showStacks</span>();</span><br><span class="line">    <span class="comment">// getAlgorithm() 获取算法名称</span></span><br><span class="line">    <span class="keyword">var</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>();</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot; update(&#x27;[B&#x27;)&quot;</span>;</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, data);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, data);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, data);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;===========================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 这个是定义字符串从什么地方开始截取，取多长</span></span><br><span class="line">messageDigest.<span class="property">update</span>.<span class="title function_">overload</span>(<span class="string">&#x27;[B&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;int&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">data,start, len</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;MessageDigest update(&#x27;[B&#x27;, &#x27;int&#x27;, &#x27;int&#x27;)&quot;</span>);</span><br><span class="line">    <span class="title function_">showStacks</span>();</span><br><span class="line">    <span class="keyword">var</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>();</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot; update(&#x27;[B&#x27;)&quot;</span>;</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, data);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, data);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, data);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;==============================================&quot;</span>, start, len);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(data, start, len);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/../%E5%9B%BE%E7%89%87/image-20241106200233800.png" alt="image-20241106200233800"></p>
<h4 id="SHA-1"><a href="#SHA-1" class="headerlink" title="SHA"></a>SHA</h4><p>SHA算法在安卓中实现的时候，就和MD5几乎一样，只有一个名字不一样，但是又使用了 MessageDigest 类的 getAlgorithm 方法，来获取传入的名字，这个时候MD5的和SHA的hook就是互通的</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241106200618601.png" alt="image-20241106200618601"></p>
<p>hook digest方法</p>
<p>toUtf8就是看热闹，包乱码的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hook digest方法</span></span><br><span class="line">messageDigest.<span class="property">digest</span>.<span class="title function_">overload</span>().<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;MessageDigest digest()&quot;</span>);</span><br><span class="line">    <span class="title function_">showStacks</span>();</span><br><span class="line">    <span class="keyword">var</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>();</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot; digest data&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="title function_">digest</span>();</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, result);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, result);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, result);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;==================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">messageDigest.<span class="property">digest</span>.<span class="title function_">overload</span>(<span class="string">&#x27;[B&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;MessageDigest digest()&quot;</span>);</span><br><span class="line">    <span class="title function_">showStacks</span>();</span><br><span class="line">    <span class="keyword">var</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>();</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot; digest data&quot;</span>;</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, data);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, data);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, data);</span><br><span class="line">    <span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="title function_">digest</span>(data);</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, result);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, result);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, result);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;==================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">messageDigest.<span class="property">digest</span>.<span class="title function_">overload</span>(<span class="string">&#x27;[B&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;int&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">data, start, len</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;MessageDigest digest()&quot;</span>);</span><br><span class="line">    <span class="title function_">showStacks</span>();</span><br><span class="line">    <span class="keyword">var</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>();</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot; digest data&quot;</span>;</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, data);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, data);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, data);</span><br><span class="line">    <span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="title function_">digest</span>(data, start, len);</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, result);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, result);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, result);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;==================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/../%E5%9B%BE%E7%89%87/image-20241106203420408.png" alt="image-20241106203420408"></p>
<h3 id="MAC算法"><a href="#MAC算法" class="headerlink" title="MAC算法"></a>MAC算法</h3><p>MAC系列算法</p>
<table>
<thead>
<tr>
<th align="center">算法</th>
<th align="center">摘要长度</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">HmacMD5</td>
<td align="center">128</td>
<td align="center">Java6实现</td>
</tr>
<tr>
<td align="center">HmacSHA1</td>
<td align="center">160</td>
<td align="center">Java6实现</td>
</tr>
<tr>
<td align="center">HmacSHA256</td>
<td align="center">256</td>
<td align="center">Java6实现</td>
</tr>
<tr>
<td align="center">HmacSHA384</td>
<td align="center">384</td>
<td align="center">Java6实现</td>
</tr>
<tr>
<td align="center">HmacSHA512</td>
<td align="center">512</td>
<td align="center">Java6实现</td>
</tr>
<tr>
<td align="center">HmacMD2</td>
<td align="center">128</td>
<td align="center">Bouncy Castle实现</td>
</tr>
<tr>
<td align="center">HmacMD4</td>
<td align="center">128</td>
<td align="center">Bouncy Castle实现</td>
</tr>
<tr>
<td align="center">HmacSHA224</td>
<td align="center">224</td>
<td align="center">Bouncy Castle实现</td>
</tr>
</tbody></table>
<p>MAC算法和MD和SHA算法的唯一区别就是多了一个密钥，密钥可以随便给</p>
<p>Java实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// 首先实例化密钥，指明算法名字，得到密钥对象</span></span><br><span class="line">   <span class="type">SecretKeySpec</span> <span class="variable">secretKeySpec</span> <span class="operator">=</span> </span><br><span class="line">       <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(<span class="string">&quot;a12345678&quot;</span>.getBytes(), <span class="string">&quot;HmacSHA1&quot;</span>);</span><br><span class="line"><span class="comment">// 获取算法名字，这里也可以直接给明文</span></span><br><span class="line">   <span class="type">Mac</span> <span class="variable">mac</span> <span class="operator">=</span> Mac.getInstance(secretKeySpec.getAlgorithm());</span><br><span class="line"><span class="comment">// 初始化密钥</span></span><br><span class="line">   mac.init(secretKeySpec);</span><br><span class="line"><span class="comment">// 这个就是和md5等相同了，放入明文，有重载函数</span></span><br><span class="line">   mac.update(<span class="string">&quot;demo&quot;</span>.getBytes());</span><br><span class="line"><span class="comment">// 和digest相似</span></span><br><span class="line">   mac.doFinal();</span><br></pre></td></tr></table></figure>



<h4 id="hook-MAC算法"><a href="#hook-MAC算法" class="headerlink" title="hook MAC算法"></a>hook MAC算法</h4><p>根据Java实现来hook算法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mac = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;javax.crypto.Mac&quot;</span>)</span><br><span class="line"><span class="comment">// 获取密钥，可以hook init方法也可以hook SecretKeySpec构造方法</span></span><br><span class="line">mac.<span class="property">init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.security.Key&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Mac Key&quot;</span>)</span><br><span class="line">    <span class="title function_">showStacks</span>();</span><br><span class="line">    <span class="keyword">var</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>();</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot; Mac Key&quot;</span>;</span><br><span class="line">    <span class="comment">// key.getEncoded() 获取密钥的字节数组</span></span><br><span class="line">    <span class="title function_">toBase64</span>(tag, key.<span class="title function_">getEncoded</span>());</span><br><span class="line">    <span class="title function_">toHex</span>(tag, key.<span class="title function_">getEncoded</span>());</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, key.<span class="title function_">getEncoded</span>());</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">init</span>(key);</span><br><span class="line">&#125;</span><br><span class="line">mac.<span class="property">init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.security.Key&#x27;</span>, <span class="string">&#x27;java.security.spec.AlgorithmParameterSpec&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Mac Key&quot;</span>)</span><br><span class="line">    <span class="comment">// showStacks();</span></span><br><span class="line">    <span class="keyword">var</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>();</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot;Mac Key&quot;</span>;</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, key.<span class="title function_">getEncoded</span>());</span><br><span class="line">    <span class="title function_">toHex</span>(tag, key.<span class="title function_">getEncoded</span>());</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, key.<span class="title function_">getEncoded</span>());</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">init</span>(key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mac.<span class="property">update</span>.<span class="title function_">overload</span>(<span class="string">&#x27;byte&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Mac update(&#x27;byte&#x27;)&quot;</span>)</span><br><span class="line">    <span class="comment">// showStacks();</span></span><br><span class="line">    <span class="keyword">var</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>();</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot; Mac update(&#x27;byte&#x27;)&quot;</span>;</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, data);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, data);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, data);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;=====================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(data);</span><br><span class="line">&#125;</span><br><span class="line">mac.<span class="property">update</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.nio.ByteBuffer&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Mac update(&#x27;java.nio.ByteBuffer&#x27;)&quot;</span>)</span><br><span class="line">    <span class="comment">// showStacks();</span></span><br><span class="line">    <span class="keyword">var</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>();</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot; Mac update(&#x27;java.nio.ByteBuffer&#x27;)&quot;</span>;</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, data);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, data);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, data);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;=====================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(data);</span><br><span class="line">&#125;</span><br><span class="line">mac.<span class="property">update</span>.<span class="title function_">overload</span>(<span class="string">&#x27;[B&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Mac update(&#x27;[B&#x27;)&quot;</span>)</span><br><span class="line">    <span class="comment">// showStacks();</span></span><br><span class="line">    <span class="keyword">var</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>();</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot; Mac update(&#x27;[B&#x27;)&quot;</span>;</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, data);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, data);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, data);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;=====================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(data);</span><br><span class="line">&#125;</span><br><span class="line">mac.<span class="property">update</span>.<span class="title function_">overload</span>(<span class="string">&#x27;[B&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;int&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">data, start, len</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Mac update(&#x27;[B&#x27;, &#x27;int&#x27;, &#x27;int&#x27;)&quot;</span>)</span><br><span class="line">    <span class="comment">// showStacks();</span></span><br><span class="line">    <span class="keyword">var</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>();</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot; Mac update(&#x27;[B&#x27;, &#x27;int&#x27;, &#x27;int&#x27;)&quot;</span>;</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, data);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, data);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, data);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;=====================================&quot;</span>, start, len);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(data, start, len);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mac.<span class="property">doFinal</span>.<span class="title function_">overload</span>().<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Mac doFinal()&quot;</span>)</span><br><span class="line">    <span class="comment">// showStacks();</span></span><br><span class="line">    <span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="title function_">doFinal</span>();</span><br><span class="line">    <span class="keyword">var</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>();</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot; Mac doFinal()&quot;</span>;</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, result);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, result);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, result);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;======================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">mac.<span class="property">doFinal</span>.<span class="title function_">overload</span>(<span class="string">&#x27;[B&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Mac doFinal(&#x27;[B&#x27;)&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="title function_">doFinal</span>(data);</span><br><span class="line">    <span class="keyword">var</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>();</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot; Mac doFinal()&quot;</span>;</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, result);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, result);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, result);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;======================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">mac.<span class="property">doFinal</span>.<span class="title function_">overload</span>(<span class="string">&#x27;[B&#x27;</span>, <span class="string">&#x27;int&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">data, start</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Mac doFinal(&#x27;[B&#x27;, &#x27;int&#x27;)&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">doFinal</span>(data, start);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="对称加密算法"><a href="#对称加密算法" class="headerlink" title="对称加密算法"></a>对称加密算法</h2><blockquote>
<p>1、加密&#x2F;解密过程可逆的算法，叫做加密算法</p>
<p>2、加密&#x2F;解密使用相同的密钥，叫做对称加密算法</p>
<p>3、对称加密算法的密钥可以随便给，但是有位数要求</p>
<p>4、对称加密算法的输入数据没有长度要求，加密速度快</p>
<p>5、各算法的密钥长度</p>
<p>​		RC4  密钥长度1-256字节</p>
<p>​		DES  密钥长度8字节</p>
<p>​		3DES&#x2F;DESede&#x2F;TripleDES  密钥长度24字节</p>
<p>​		AES  密钥长度16、24、32字节</p>
<p>​		根据密钥长度不同的AES又分为AES-128、AES-192、AES-256</p>
<p>6、对称加密分类</p>
<p>​		a. 序列加密&#x2F;流加密：以字节流的方式，依次加密(解密)明文(密文)中的每一个字节</p>
<p>​				RC4</p>
<p>​		b. 分组加密：将明文信息分组（每组有多个字节），逐组进行加密</p>
<p>​				DES、3DES、AES</p>
</blockquote>
<p>PS：MAC密钥是可以无限给的，如果密钥长度超过512bit，就计算密钥的MD5，使用MD5值作为密钥</p>
<p>PS：流加密和分组加密很好区分，流加密每增加一个字符密文长度就会变化，而分组加密是在一定的字节范围内，密文长度是不变的，超出这个长度，密文长度变长一倍</p>
<h3 id="DES算法"><a href="#DES算法" class="headerlink" title="DES算法"></a>DES算法</h3><p>Java实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加密</span></span><br><span class="line"><span class="comment">// 还是定义密钥key和加密方式</span></span><br><span class="line"><span class="type">SecretKeySpec</span> <span class="variable">secretKeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(<span class="string">&quot;123454678&quot;</span>.getBytes(), <span class="string">&quot;DES&quot;</span>);</span><br><span class="line"><span class="comment">// 还有一种方式，这个API有密钥长度判断，如果传入的密钥过长，会自动截取8个字节</span></span><br><span class="line"><span class="type">DESKeySpec</span> <span class="variable">desKeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DESKeySpec</span>(<span class="string">&quot;12345678&quot;</span>.getBytes());</span><br><span class="line"></span><br><span class="line"><span class="comment">// getInstance得到一个单例，一个虚拟机只此一份</span></span><br><span class="line"><span class="type">Cipher</span> <span class="variable">des</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;DES/ECB/PKCS5Padding&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ENCRYPT_MOOE的值为1代表加密模式，DECRYPT_MOOD为2代表解密模式</span></span><br><span class="line">des.init(Cipher.ENCRYPT_MODE, secretKeySpec);</span><br><span class="line"><span class="comment">// 这里使用 doFinal 进行加密操作获取加密结果，因为update方法有问题，所以实现对称加密算法，一般传到 doFinal 方法中</span></span><br><span class="line"><span class="type">byte</span>[] result = des.doFinal(<span class="string">&quot;demo&quot;</span>.getBytes());</span><br><span class="line"><span class="type">String</span> <span class="variable">hexStr</span> <span class="operator">=</span> ByteString.of(result).hex();</span><br><span class="line">System.out.println(hexStr);</span><br><span class="line">System.out.println(Base64.getEncoder().encodeToString(result));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解密</span></span><br><span class="line">des.init(Cipher.DECRYPT_MOOD, secretKeySpec);</span><br><span class="line"><span class="type">byte</span>[] result1 = des.doFinal();</span><br><span class="line">System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(result1));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>特点：</p>
<p>1、对称加密算法里，使用NOPadding，加密的明文必须等于分组长度倍数，否则报错</p>
<p>2、没有指明加密模式和填充模式的，表示使用默认的 DES&#x2F;ECB&#x2F;PKCS5Padding</p>
<p>3、加密后的字节数组可以编码成hex、base64</p>
<p>4、要复现一个对称加密算法，需要得到明文，key、iv、mode、padding</p>
<p>5、明文、key、iv需要注意解析方式，看是utf-8还是hex，不一定都是字符串形式</p>
<p>6、ECB模式和CBC模式的区别</p>
<p>7、如果加密模式是ECB，则不需要加iv，加了的话包报错的</p>
<p>8、如果使用PKCS5Padding，会对加密的明文填充1字节至一个分组的长度</p>
<p>9、DES算法明文按64位进行分组加密</p>
<p>10、如果明文中有两个分组的内容相同，ECB会得到完全一样的密文，CBC不会</p>
<p>11、加密算法的结果通常与明文等长或者更长，如果变短了，可能是gzip、protobuf，或者信息摘要算法</p>
</blockquote>
<h3 id="加密模式"><a href="#加密模式" class="headerlink" title="加密模式"></a>加密模式</h3><p>对称加密算法中，不光有密钥，还有一个IV值，上方的演示因为是 ECB 模式，没有用到 IV 值，但是逆向中常见的是 CBC 模式，这个是存在一个IV向量值的</p>
<p>这个IV向量是有长度限制的，根据算法的分组长度不同，IV长度也不同，DES加密的IV向量占8个字节</p>
<h4 id="ECB模式和CBC模式"><a href="#ECB模式和CBC模式" class="headerlink" title="ECB模式和CBC模式"></a>ECB模式和CBC模式</h4><blockquote>
<p>这二者都是分组加密的形式</p>
<p>ECB模式，分八个字节一组，分别加密，得到密文</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">明文：sjjwsnb666</span><br><span class="line">分割为： sjjwsnb6 66</span><br><span class="line">sjjwsnb666 加密结果： Vmkul5panJ +bu+Jo4DZ7Lw==</span><br><span class="line">					56692e979a5a9c9f 9bbbe268e0367b2f</span><br><span class="line">sjjwsnb6   加密结果： Vmkul5panJ /+uVm31GQvyw==</span><br><span class="line">					56692e979a5a9c9f feb959b7d4642fcb</span><br><span class="line"></span><br><span class="line">空格我自己加的，可以看到有很明显的分组痕迹，各管各的，拿出一段密文就可以获取部分明文，甚至可以自己加密一部分密文替换掉，达到替换明文的目的</span><br></pre></td></tr></table></figure>

<p>ECB模式是不安全的</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241107122725336.png" alt="image-20241107122725336"></p>
<p>CBC模式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">明文：sjjwsnb666</span><br><span class="line">IV： 12345678</span><br><span class="line"></span><br><span class="line">明文分组： sjjwsnb6 66</span><br><span class="line"></span><br><span class="line">CBC模式处理时先异或操作</span><br><span class="line">sjjwsnb6 &amp; 12345678</span><br><span class="line">再将异或的结果进行加密操作</span><br><span class="line">假如结果是：asddfgfh</span><br><span class="line"></span><br><span class="line">再将下一组和上一组加密的结果异或</span><br><span class="line">asddfgfh &amp; 66</span><br><span class="line">再进行加密，这样前后串连起来，断绝了更改密文影响明文的操作，更加的安全</span><br></pre></td></tr></table></figure>




</blockquote>
<p>CBC加密模式实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">      <span class="type">SecretKeySpec</span> <span class="variable">secretKeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(<span class="string">&quot;123454678&quot;</span>.getBytes(), <span class="string">&quot;DES&quot;</span>);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 这里定义iv向量值</span></span><br><span class="line">      <span class="type">IvParameterSpec</span> <span class="variable">ivParameterSpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IvParameterSpec</span>(<span class="string">&quot;12345678&quot;</span>.getBytes());</span><br><span class="line">      <span class="type">Cipher</span> <span class="variable">des</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;DES/CBC/PKCS5Padding&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 这里初始化时需要添加上iv值</span></span><br><span class="line">      des.init(Cipher.ENCRYPT_MODE ,secretKeySpec, ivParameterSpec);</span><br><span class="line">      <span class="type">byte</span>[] result = des.doFinal(<span class="string">&quot;demo&quot;</span>.getBytes());</span><br><span class="line">      <span class="type">String</span> <span class="variable">hexStr</span> <span class="operator">=</span> ByteString.of(result).hex();</span><br><span class="line">      System.out.println(hexStr);</span><br><span class="line">      System.out.println(Base64.getEncoder().encodeToString(result));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解密亦同</span></span><br><span class="line">      des.init(Cipher.DECRYPT_MODE, secretKeySpec, ivParameterSpec);</span><br><span class="line">      <span class="type">byte</span>[] result1 = des.doFinal(result);</span><br><span class="line">      System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(result1));</span><br></pre></td></tr></table></figure>





<h3 id="填充方式"><a href="#填充方式" class="headerlink" title="填充方式"></a>填充方式</h3><p>“DES&#x2F;CBC&#x2F;PKCS5Padding”中 CBC 是加密模式，PKCS5Padding是填充方式</p>
<blockquote>
<p>NOPadding方式：必须是整组的数据，否则加密失败，拿到ECB的整组数据，进行NOPadding就可以得到明文</p>
<p>PKCS5Padding填充：如果使用了PKCS5Padding填充，填充的是一个字节到一个分组的长度，这就是为啥刚好8位明文，还会增加一个空分组的原因，如果最后只有一个字节，那么就会填充7个字节上去</p>
</blockquote>
<h4 id="DES密钥的漏洞"><a href="#DES密钥的漏洞" class="headerlink" title="DES密钥的漏洞"></a>DES密钥的漏洞</h4><p>DES的密钥虽然是64个字节，但是真正使用的只有56个字节，每个字节的最后一位会被舍去，看一下演示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">先令密钥位12345678</span><br><span class="line">字节表示为：00110001 00110010 00110011 00110100 00110101 00110110 00110111 00111000</span><br><span class="line"></span><br><span class="line">将字节最后一位随便改，这里都改成0了：</span><br><span class="line">00110000 00110010 00110010 00110100 00110100 00110110 00110110 00111000</span><br><span class="line">转换成数字为：02244668</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">使用12345678来加密字符串，结果为96d0028878d58c89feb959b7d4642fcb</span><br><span class="line">使用02244668来加密字符串，结果为96d0028878d58c89feb959b7d4642fcb</span><br></pre></td></tr></table></figure>



<p>加密结果是一样的，最后一个bit位是不重要的，也就是说可以有好几个密钥来进行加解密得到同样的结果</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241107135559234.png" alt="image-20241107135559234"></p>
<h3 id="DESede算法"><a href="#DESede算法" class="headerlink" title="DESede算法"></a>DESede算法</h3><p>又叫3DES，DESede算法进行三次DES操作，需要24位密钥，先用前八位密钥进行DES加密，再用中间八位密钥进行DES解密，最后用剩下的八位密钥进行DES加密。所以说如果前两组的密钥是一样的话，就相当于只用了后八位进行一次DES加密，效果是一样的</p>
<p>同样的有密钥问题</p>
<p>看看怎么用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   <span class="type">SecretKeySpec</span> <span class="variable">secretKeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(<span class="string">&quot;123456781234567812345678&quot;</span>.getBytes(), <span class="string">&quot;DESede&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// DESede也是有一个API，也是如果密钥长度过长取前24字节</span></span><br><span class="line"><span class="type">DESedeKeySpec</span> <span class="variable">deskeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DesedeKeySpec</span>(<span class="string">&quot;123456788765432112345678&quot;</span>.getBytes())</span><br><span class="line"></span><br><span class="line">   <span class="type">IvParameterSpec</span> <span class="variable">iv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IvParameterSpec</span>(<span class="string">&quot;12345678&quot;</span>.getBytes());</span><br><span class="line">   <span class="type">Cipher</span> <span class="variable">desede</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;DESede/CBC/PKCS5Padding&quot;</span>);</span><br><span class="line">   desede.init(Cipher.ENCRYPT_MODE, secretKeySpec, iv);</span><br><span class="line">   desede.doFinal(<span class="string">&quot;demo&quot;</span>.getBytes());</span><br></pre></td></tr></table></figure>





<h3 id="AES算法"><a href="#AES算法" class="headerlink" title="AES算法"></a>AES算法</h3><p>DES算法还是有很大的问题的，现在使用AES算法居多</p>
<p>根据密钥长度不同，分为AES128、AES192、AES256。分别对应16、20、32个字节</p>
<table>
<thead>
<tr>
<th align="center">AES</th>
<th align="center">密钥长度(bit)</th>
<th align="center">分组长度(bit)</th>
<th align="center">向量长度(bit)</th>
<th align="center">加密轮数</th>
</tr>
</thead>
<tbody><tr>
<td align="center">AES-128</td>
<td align="center">128</td>
<td align="center">128</td>
<td align="center">128</td>
<td align="center">10</td>
</tr>
<tr>
<td align="center">AES-192</td>
<td align="center">192</td>
<td align="center">128</td>
<td align="center">128</td>
<td align="center">12</td>
</tr>
<tr>
<td align="center">AES-256</td>
<td align="center">256</td>
<td align="center">128</td>
<td align="center">128</td>
<td align="center">14</td>
</tr>
</tbody></table>
<p>实现</p>
<p>AES算法明文按128位进行分组加密，其余特征与DES一致</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// AES算法没有特定的key的方法，使用SecretKeySpec定义密钥</span></span><br><span class="line">   <span class="type">SecretKeySpec</span> <span class="variable">secretKeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(<span class="string">&quot;1234567890abcdef&quot;</span>.getBytes(), <span class="string">&quot;AES&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// iv 长度为16字节</span></span><br><span class="line">   <span class="type">AlgorithmParameterSpec</span> <span class="variable">iv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IvParameterSpec</span>(<span class="string">&quot;1234567890abcdef&quot;</span>.getBytes());</span><br><span class="line">   <span class="type">Cipher</span> <span class="variable">aes</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;AES/CBC/PKCS5Padding&quot;</span>);</span><br><span class="line">   aes.init(Cipher.ENCRYPT_MODE, secretKeySpec, iv);</span><br><span class="line">   aes.doFinal(<span class="string">&quot;demodemodemo1234567890abcdef&quot;</span>.getBytes());</span><br></pre></td></tr></table></figure>





<h3 id="通杀hook"><a href="#通杀hook" class="headerlink" title="通杀hook"></a>通杀hook</h3><h4 id="DES"><a href="#DES" class="headerlink" title="DES"></a>DES</h4><p>看到这就可以发现，hook的函数其实是大同小异的，主要的是看hook的一个思路</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DES算法</span></span><br><span class="line"><span class="keyword">var</span> des = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;javax.crypto.Cipher&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里之所以不传值，是因为 return this.init.apply(this, arguments) ,this表示调用原始方法的对象，arguments表示原始方法的参数</span></span><br><span class="line">des.<span class="property">init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;java.security.cert.Certificate&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Cipher init(&#x27;int&#x27;, &#x27;java.security.cert.Certificate&#x27;)&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;=============================================================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">init</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line">des.<span class="property">init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;java.security.Key&#x27;</span>, <span class="string">&#x27;java.security.SecureRandom&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Cipher init(&#x27;int&#x27;, &#x27;java.security.Key&#x27;, &#x27;java.security.SecureRandom&#x27;)&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;=============================================================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">init</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line">des.<span class="property">init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;java.security.cert.Certificate&#x27;</span>, <span class="string">&#x27;java.security.SecureRandom&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Cipher init(&#x27;int&#x27;, &#x27;java.security.cert.Certificate&#x27;, &#x27;java.security.SecureRandom&#x27;)&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;=============================================================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">init</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line">des.<span class="property">init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;java.security.Key&#x27;</span>, <span class="string">&#x27;java.security.spec.AlgorithmParameterSpec&#x27;</span>, <span class="string">&#x27;java.security.SecureRandom&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Cipher init(&#x27;int&#x27;, &#x27;java.security.Key&#x27;, &#x27;java.security.spec.AlgorithmParameterSpec&#x27;, &#x27;java.security.SecureRandom&#x27;)&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;=============================================================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">init</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line">des.<span class="property">init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;java.security.Key&#x27;</span>, <span class="string">&#x27;java.security.AlgorithmParameters&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Cipher init(&#x27;int&#x27;, &#x27;java.security.Key&#x27;, &#x27;java.security.AlgorithmParameters&#x27;)&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;=============================================================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">init</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line">des.<span class="property">init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;java.security.Key&#x27;</span>, <span class="string">&#x27;java.security.AlgorithmParameters&#x27;</span>, <span class="string">&#x27;java.security.SecureRandom&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Cipher init(&#x27;int&#x27;, &#x27;java.security.Key&#x27;, &#x27;java.security.AlgorithmParameters&#x27;, &#x27;java.security.SecureRandom&#x27;)&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;=============================================================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">init</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 上面的不重要，随随便便打印一下看看有没有运行就行了，这两个则是传密钥和IV向量的方法 </span></span><br><span class="line">des.<span class="property">init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;java.security.Key&#x27;</span>, <span class="string">&#x27;java.security.spec.AlgorithmParameterSpec&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Cipher init(&#x27;int&#x27;, &#x27;java.security.Key&#x27;, &#x27;java.security.spec.AlgorithmParameterSpec&#x27;)&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>();</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot;init key&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> key = <span class="variable language_">arguments</span>[<span class="number">1</span>].<span class="title function_">getEncoded</span>();</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, key);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, key);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, key);</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot;init iv&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> iv = <span class="title class_">Java</span>.<span class="title function_">cast</span>(<span class="variable language_">arguments</span>[<span class="number">2</span>], <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;javax.crypto.spec.IvParameterSpec&quot;</span>));</span><br><span class="line">    iv = iv.<span class="title function_">getIV</span>();</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, iv);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, iv);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, iv);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;=============================================================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">init</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line">des.<span class="property">init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;java.security.Key&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Cipher init(&#x27;int&#x27;, &#x27;java.security.Key&#x27;)&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>();</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot;init key&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> key = <span class="variable language_">arguments</span>[<span class="number">1</span>].<span class="title function_">getEncoded</span>();</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, key);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, key);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, key);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;=============================================================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">init</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// doFinal方法</span></span><br><span class="line">des.<span class="property">doFinal</span>.<span class="title function_">overload</span>().<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Cipher doFinal()&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">doFinal</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line">des.<span class="property">doFinal</span>.<span class="title function_">overload</span>(<span class="string">&quot;java.nio.ByteBuffer&quot;</span>, <span class="string">&quot;java.nio.ByteBuffer&quot;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Cipher doFinal(&#x27;java.nio.ByteBuffer&#x27;, &#x27;java.nio.ByteBuffer&#x27;)&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">doFinal</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line">des.<span class="property">doFinal</span>.<span class="title function_">overload</span>(<span class="string">&#x27;[B&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Cipher doFinal(&#x27;[B&#x27;)&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">doFinal</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line">des.<span class="property">doFinal</span>.<span class="title function_">overload</span>(<span class="string">&#x27;[B&#x27;</span>, <span class="string">&#x27;int&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Cipher doFinal(&#x27;[B&#x27;, &#x27;int&#x27;)&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;=======================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">doFinal</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line">des.<span class="property">doFinal</span>.<span class="title function_">overload</span>(<span class="string">&#x27;[B&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;[B&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Cipher doFinal(&#x27;[B&#x27;, &#x27;int&#x27;, &#x27;int&#x27;, &#x27;[B&#x27;)&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;===============================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">doFinal</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line">des.<span class="property">doFinal</span>.<span class="title function_">overload</span>(<span class="string">&#x27;[B&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;[B&#x27;</span>, <span class="string">&#x27;int&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Cipher doFinal(&#x27;[B&#x27;, &#x27;int&#x27;, &#x27;int&#x27;, &#x27;[B&#x27;, &#x27;int&#x27;)&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;===================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">doFinal</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 和其他的加密方法差不多，这两个方法重要</span></span><br><span class="line">des.<span class="property">doFinal</span>.<span class="title function_">overload</span>(<span class="string">&#x27;[B&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;int&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Cipher doFinal(&#x27;[B&#x27;, &#x27;int&#x27;, &#x27;int&#x27;)&quot;</span>)</span><br><span class="line">    <span class="title function_">showStacks</span>();</span><br><span class="line">    <span class="keyword">var</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>();</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot; doFinal data&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> data = <span class="variable language_">arguments</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, data);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, data);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, data);</span><br><span class="line">    <span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="property">doFinal</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot; doFinal result&quot;</span>;</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, result);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, result);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, result);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;=======================================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">des.<span class="property">doFinal</span>.<span class="title function_">overload</span>(<span class="string">&#x27;[B&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Cipher doFinal(&#x27;[B&#x27;)&quot;</span>)</span><br><span class="line">    <span class="title function_">showStacks</span>();</span><br><span class="line">    <span class="keyword">var</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>();</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot; doFinal data&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> data = <span class="variable language_">arguments</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, data);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, data);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, data);</span><br><span class="line">    <span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="property">doFinal</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot; doFinal result&quot;</span>;</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, result);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, result);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, result);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;===============================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这个不只是hookDES算法，DESede、AES和RSA都包含在内的，通杀了属于是</p>
</blockquote>
<h4 id="DESede"><a href="#DESede" class="headerlink" title="DESede"></a>DESede</h4><p>看一下两个加密方法的差别</p>
<p>可以看到中加密方式几乎使用的方法是一模一样的，DES直接就给他杀了，不用写其他的了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DES</span></span><br><span class="line"><span class="type">SecretKeySpec</span> <span class="variable">secretKeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(<span class="string">&quot;123454678&quot;</span>.getBytes(), <span class="string">&quot;DES&quot;</span>);</span><br><span class="line"><span class="type">Cipher</span> <span class="variable">des</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;DES/ECB/PKCS5Padding&quot;</span>);</span><br><span class="line">des.init(Cipher.ENCRYPT_MODE, secretKeySpec);</span><br><span class="line">des.doFinal(<span class="string">&quot;demo&quot;</span>.getBytes());</span><br><span class="line"></span><br><span class="line">               </span><br><span class="line"></span><br><span class="line"><span class="comment">// DESede</span></span><br><span class="line">   <span class="type">SecretKeySpec</span> <span class="variable">secretKeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(<span class="string">&quot;123456781234567812345678&quot;</span>.getBytes(), <span class="string">&quot;DESede&quot;</span>);</span><br><span class="line">   <span class="type">IvParameterSpec</span> <span class="variable">iv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IvParameterSpec</span>(<span class="string">&quot;12345678&quot;</span>.getBytes());</span><br><span class="line">   <span class="type">Cipher</span> <span class="variable">desede</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;DESede/CBC/PKCS5Padding&quot;</span>);</span><br><span class="line">   desede.init(Cipher.ENCRYPT_MODE, secretKeySpec, iv);</span><br><span class="line">   desede.doFinal(<span class="string">&quot;demo&quot;</span>.getBytes());</span><br></pre></td></tr></table></figure>





<h4 id="AES"><a href="#AES" class="headerlink" title="AES"></a>AES</h4><p>同上，一起杀了，就是IV不一样，但是不需要hook这个iv</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// AES算法没有特定的key的方法，使用SecretKeySpec定义密钥</span></span><br><span class="line">   <span class="type">SecretKeySpec</span> <span class="variable">secretKeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(<span class="string">&quot;1234567890abcdef&quot;</span>.getBytes(), <span class="string">&quot;AES&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// iv 长度为16字节</span></span><br><span class="line">   <span class="type">AlgorithmParameterSpec</span> <span class="variable">iv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IvParameterSpec</span>(<span class="string">&quot;1234567890abcdef&quot;</span>.getBytes());</span><br><span class="line">   <span class="type">Cipher</span> <span class="variable">aes</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;AES/CBC/PKCS5Padding&quot;</span>);</span><br><span class="line">   aes.init(Cipher.ENCRYPT_MODE, secretKeySpec, iv);</span><br><span class="line">   aes.doFinal(<span class="string">&quot;demodemodemo1234567890abcdef&quot;</span>.getBytes());</span><br></pre></td></tr></table></figure>





<h2 id="非对称加密算法"><a href="#非对称加密算法" class="headerlink" title="非对称加密算法"></a>非对称加密算法</h2><h3 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h3><p>RSA算法是一个非对称加密算法，就是说加密和解密不使用同一个密钥，分为公钥和私钥，公钥用来加密数据，私钥用来解密数据</p>
<h4 id="私钥的格式"><a href="#私钥的格式" class="headerlink" title="私钥的格式"></a>私钥的格式</h4><p>pkcs1格式通常开头是 <code>-----BEGIN RSA PRIVATE KEY -----</code></p>
<p>pkcs8格式通常开头是 <code>-----BEGIN PRIVATE KEY-----</code> </p>
<p>java中的私钥必须是pkcs8格式，如果得到了pkcs1，需要转成pkcs8</p>
<p><a target="_blank" rel="noopener" href="https://www.ssleye.com/ssltool/pkcs.html">https://www.ssleye.com/ssltool/pkcs.html</a></p>
<p><a target="_blank" rel="noopener" href="http://web.chacuo.net/netrsakeypair">http://web.chacuo.net/netrsakeypair</a></p>
<h4 id="RSA密钥的解析"><a href="#RSA密钥的解析" class="headerlink" title="RSA密钥的解析"></a>RSA密钥的解析</h4><p>去在线网站上弄一个没有密码的RSA密钥对</p>
<p>公钥</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">pubKey</span><span class="params">()</span> <span class="keyword">throws</span> InvalidKeySpecException, NoSuchAlgorithmException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC2kIa+rcK0oirgwxOM9tIkW95i&quot;</span> +</span><br><span class="line">            <span class="string">&quot;GNpo7tmiR8KLOapz13kYcy0csBeIJ6R44J3KEWVQcrjSqkPGeQtOrPYl1LxX5evb&quot;</span> +</span><br><span class="line">            <span class="string">&quot;DsIjmKBZXu4w8FkFxCW0ItaJu2qrX+3vr14g+JXcOYrcED+l53pwQ5sls1bbHqAe&quot;</span> +</span><br><span class="line">            <span class="string">&quot;V+I+MfaZ2XWYTNRbRwIDAQAB&quot;</span>;</span><br><span class="line">    <span class="comment">// 解码密钥</span></span><br><span class="line">    <span class="type">byte</span>[] keyBytes = ByteString.decodeBase64(key).toByteArray();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 公钥使用 X509EncodedKeySpec ，私钥使用 PKCS8EncodedKeySpec，这两个是限于Base64的，如果是hex还有其他API</span></span><br><span class="line">    <span class="type">X509EncodedKeySpec</span> <span class="variable">keySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">X509EncodedKeySpec</span>(keyBytes);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 然后使用 KeyFactory 来指明密钥类型</span></span><br><span class="line">    <span class="type">KeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 然后使用 publicKey 来生成public类型的密钥</span></span><br><span class="line">    <span class="type">PublicKey</span> <span class="variable">publicKey</span> <span class="operator">=</span> keyFactory.generatePublic(keySpec);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用publickey的getEncode方法可以返回来得到密钥的byte数组，这个时候再输出base64的编码结果和原文是一样的</span></span><br><span class="line">    <span class="type">byte</span>[] keyBytes = publickey.getEncode();</span><br><span class="line">    System.out.println(Base64.getEncoder().encodeToString(bytes));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>私钥</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">staticKey</span><span class="params">()</span> <span class="keyword">throws</span> InvalidKeySpecException, NoSuchAlgorithmException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">stakey</span> <span class="operator">=</span> <span class="string">&quot;MIICdgIBADANBgkqhkiG9w0BAQEFAASCAmAwggJcAgEAAoGBALaQhr6twrSiKuDD&quot;</span> +</span><br><span class="line">            <span class="string">&quot;E4z20iRb3mIY2mju2aJHwos5qnPXeRhzLRywF4gnpHjgncoRZVByuNKqQ8Z5C06s&quot;</span> +</span><br><span class="line">            <span class="string">&quot;9iXUvFfl69sOwiOYoFle7jDwWQXEJbQi1om7aqtf7e+vXiD4ldw5itwQP6XnenBD&quot;</span> +</span><br><span class="line">            <span class="string">&quot;myWzVtseoB5X4j4x9pnZdZhM1FtHAgMBAAECgYBDKOW4zZk79BBMANd3WvExWO51&quot;</span> +</span><br><span class="line">            <span class="string">&quot;LeljAsLjFPz3VK5k0RaGLRCiZhEyEEtMAG1rgXzA3IMrVGF8aNkFB1HB1wG1wC4P&quot;</span> +</span><br><span class="line">            <span class="string">&quot;t7hZl5s2tdseXsIMmS0mpDUZZu+tnFwHcqZS4K6rIFjQ8lZn7epv32Pc/0aSliWp&quot;</span> +</span><br><span class="line">            <span class="string">&quot;5II5OZG2rrcG5C+y4QJBAPDQHba3wbuirDkq1QE3qUv05RAXGurideos9audGbf7&quot;</span> +</span><br><span class="line">            <span class="string">&quot;RXu4RjiYT7xlEVdZBARL/eAu36PDZy+GTb6No5Iqn5ECQQDCE//3YVKgUbfMDLrq&quot;</span> +</span><br><span class="line">            <span class="string">&quot;2LznXk+S5NXNbj2tocKsvQJLIa29qfd3eouQpR1osCJvqmA8aV2Z90y03yFBUOmv&quot;</span> +</span><br><span class="line">            <span class="string">&quot;B5FXAkEAzyp7JYGYDQ+5EcUjUdTMtCeOF/WIlqETx82921FfmsNz1yeEYZPGpNBd&quot;</span> +</span><br><span class="line">            <span class="string">&quot;xsMxjXDCi2ZHxt6Hmn7zywaWvVwlwQJALFNVCrL3pBYF3Fyr9Cc8PbuUgQAytJCR&quot;</span> +</span><br><span class="line">            <span class="string">&quot;Fa70P2+Lro0qmT7QfkFGzupnJRnVQ5uuDx4heqC4rDap6bkJJiicUQJAfWRkNXyX&quot;</span> +</span><br><span class="line">            <span class="string">&quot;WFvfM04BMjWSBgBOUmAVyB8GFAGh3e4uUvZYIr9oAnzdErFLDdXUyl1uCw5qrYkj&quot;</span> +</span><br><span class="line">            <span class="string">&quot;hM7Kq5Lkby/iaw==&quot;</span>;</span><br><span class="line">    <span class="comment">// 解码密钥</span></span><br><span class="line">    <span class="type">byte</span>[] keyBytes = ByteString.decodeBase64(stakey).toByteArray();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 解析密钥</span></span><br><span class="line">    <span class="type">PKCS8EncodedKeySpec</span> <span class="variable">keySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PKCS8EncodedKeySpec</span>(keyBytes);</span><br><span class="line">    <span class="comment">// 经过密钥工厂处理</span></span><br><span class="line">    <span class="type">KeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">    <span class="comment">// 得到私钥</span></span><br><span class="line">    <span class="type">PrivateKey</span> <span class="variable">privateKey</span> <span class="operator">=</span> keyFactory.generatePrivate(keySpec);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 同理</span></span><br><span class="line">    Log.d(<span class="string">&quot;demo&quot;</span>, ByteString.of(privateKey.getEncoded().base64()))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>虽然要是64的倍数，但是一般是 512，1024，2048这样的</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241114213144356.png" alt="image-20241114213144356"></p>
<h4 id="RSA加解密"><a href="#RSA加解密" class="headerlink" title="RSA加解密"></a>RSA加解密</h4><p>实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">RSACipher</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchAlgorithmException, InvalidKeySpecException, NoSuchPaddingException, InvalidKeyException, IllegalBlockSizeException, BadPaddingException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC2kIa+rcK0oirgwxOM9tIkW95i\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;GNpo7tmiR8KLOapz13kYcy0csBeIJ6R44J3KEWVQcrjSqkPGeQtOrPYl1LxX5evb\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;DsIjmKBZXu4w8FkFxCW0ItaJu2qrX+3vr14g+JXcOYrcED+l53pwQ5sls1bbHqAe\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;V+I+MfaZ2XWYTNRbRwIDAQAB&quot;</span>;</span><br><span class="line">    <span class="type">byte</span>[] keyBytes = ByteString.decodeBase64(key).toByteArray();</span><br><span class="line">    <span class="type">X509EncodedKeySpec</span> <span class="variable">keySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">X509EncodedKeySpec</span>(keyBytes);</span><br><span class="line">    <span class="type">KeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">    <span class="type">PublicKey</span> <span class="variable">publicKey</span> <span class="operator">=</span> keyFactory.generatePublic(keySpec);</span><br><span class="line">    <span class="type">byte</span>[] bytes = publicKey.getEncoded();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">stakey</span> <span class="operator">=</span> <span class="string">&quot;MIICdgIBADANBgkqhkiG9w0BAQEFAASCAmAwggJcAgEAAoGBALaQhr6twrSiKuDD&quot;</span> +</span><br><span class="line">            <span class="string">&quot;E4z20iRb3mIY2mju2aJHwos5qnPXeRhzLRywF4gnpHjgncoRZVByuNKqQ8Z5C06s&quot;</span> +</span><br><span class="line">            <span class="string">&quot;9iXUvFfl69sOwiOYoFle7jDwWQXEJbQi1om7aqtf7e+vXiD4ldw5itwQP6XnenBD&quot;</span> +</span><br><span class="line">            <span class="string">&quot;myWzVtseoB5X4j4x9pnZdZhM1FtHAgMBAAECgYBDKOW4zZk79BBMANd3WvExWO51&quot;</span> +</span><br><span class="line">            <span class="string">&quot;LeljAsLjFPz3VK5k0RaGLRCiZhEyEEtMAG1rgXzA3IMrVGF8aNkFB1HB1wG1wC4P&quot;</span> +</span><br><span class="line">            <span class="string">&quot;t7hZl5s2tdseXsIMmS0mpDUZZu+tnFwHcqZS4K6rIFjQ8lZn7epv32Pc/0aSliWp&quot;</span> +</span><br><span class="line">            <span class="string">&quot;5II5OZG2rrcG5C+y4QJBAPDQHba3wbuirDkq1QE3qUv05RAXGurideos9audGbf7&quot;</span> +</span><br><span class="line">            <span class="string">&quot;RXu4RjiYT7xlEVdZBARL/eAu36PDZy+GTb6No5Iqn5ECQQDCE//3YVKgUbfMDLrq&quot;</span> +</span><br><span class="line">            <span class="string">&quot;2LznXk+S5NXNbj2tocKsvQJLIa29qfd3eouQpR1osCJvqmA8aV2Z90y03yFBUOmv&quot;</span> +</span><br><span class="line">            <span class="string">&quot;B5FXAkEAzyp7JYGYDQ+5EcUjUdTMtCeOF/WIlqETx82921FfmsNz1yeEYZPGpNBd&quot;</span> +</span><br><span class="line">            <span class="string">&quot;xsMxjXDCi2ZHxt6Hmn7zywaWvVwlwQJALFNVCrL3pBYF3Fyr9Cc8PbuUgQAytJCR&quot;</span> +</span><br><span class="line">            <span class="string">&quot;Fa70P2+Lro0qmT7QfkFGzupnJRnVQ5uuDx4heqC4rDap6bkJJiicUQJAfWRkNXyX&quot;</span> +</span><br><span class="line">            <span class="string">&quot;WFvfM04BMjWSBgBOUmAVyB8GFAGh3e4uUvZYIr9oAnzdErFLDdXUyl1uCw5qrYkj&quot;</span> +</span><br><span class="line">            <span class="string">&quot;hM7Kq5Lkby/iaw==&quot;</span>;</span><br><span class="line">    <span class="type">byte</span>[] staKeyBytes = ByteString.decodeBase64(stakey).toByteArray();</span><br><span class="line">    <span class="type">PKCS8EncodedKeySpec</span> <span class="variable">staKeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PKCS8EncodedKeySpec</span>(staKeyBytes);</span><br><span class="line">    <span class="type">KeyFactory</span> <span class="variable">staKeyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">    <span class="type">PrivateKey</span> <span class="variable">privateKey</span> <span class="operator">=</span> staKeyFactory.generatePrivate(staKeySpec);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加密，使用公钥初始化</span></span><br><span class="line">    <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;RSA/None/NOPadding&quot;</span>);</span><br><span class="line">    cipher.init(Cipher.ENCRYPT_MODE, publicKey);</span><br><span class="line">    <span class="type">byte</span>[] bt_encrypted = cipher.doFinal(<span class="string">&quot;1232345456&quot;</span>.getBytes());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解密，使用私钥初始化</span></span><br><span class="line">    <span class="type">Cipher</span> <span class="variable">cipher1</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;RSA/None/NOPadding&quot;</span>);</span><br><span class="line">    cipher1.init(Cipher.DECRYPT_MODE, privateKey);</span><br><span class="line">    <span class="type">byte</span>[] bt_original = cipher1.doFinal(bt_encrypted);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以明显的看到RSA的实现还是cipher，那么DES的代码改都不用改</p>
<p>所谓的加密结果不固定就是使用padding的时候  bt_encrypted 的值不固定，会发生变化，但是NOpadding就是固定的</p>
</blockquote>
<h4 id="RSAd的加密模式和填充方式"><a href="#RSAd的加密模式和填充方式" class="headerlink" title="RSAd的加密模式和填充方式"></a>RSAd的加密模式和填充方式</h4><blockquote>
<p>RSA模式和填充细节</p>
<p>1、None模式与ECB模式是一致的</p>
<p>2、NOPadding</p>
<p>​		明文最多字节数为密钥字节数，如果密钥1024bit，最多加密1024bit</p>
<p>​		密文与密钥等长</p>
<p>​		填充字节0（不是字符是占8个bit位的字节），加密后的密文不变</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241116115653290.png"></p>
<p>​		NOPadding解密之后还需要进行去零，0是byte数组中的0，在数据的前面添加的</p>
<p>3、PKCS1Padding</p>
<p>​		明文最大字节数为密钥字节数 -11，如果密钥128字节，最多加密117字节，剩余的随机填充</p>
<p>​		密文与密钥等长</p>
<p>​		因为是随机填充，每一次的填充不一样，使得加密后的密文会变</p>
<p>​		有个小秘密，PKCS1Padding解密的时候不指明是会自动取出前面的填充，指明了反而不去除</p>
</blockquote>
<h4 id="RSA密钥的转换"><a href="#RSA密钥的转换" class="headerlink" title="RSA密钥的转换"></a>RSA密钥的转换</h4><p>全面使用的密钥都是使用base64编码的，也有hex的密钥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// hex不是简单的将base64的结果解码然后hex编码</span><br><span class="line">将转换后的数据进行这样的分割</span><br><span class="line">30819f300d06092a864886f70d010101050003818d0030818902818100 | bdab976385934fb3ca17ec8775da752e191ce4ef6b5dc6398b3faf60615d45ad06e01216f8f11f4cab9e43a789b296a7bb318882bf320d2a21c00f6da233607576de16e7f6f552d97c2a4db345c97db5b5fc15127bd77ff1f1f588c577959d62694819a7eecb1f23d91c45654fbe90f300f68b64429cd4770d6685a761a1ed2d | 0203 | 010001</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 这两部分没啥用了</span><br><span class="line">30819f300d06092a864886f70d010101050003818d0030818902818100</span><br><span class="line">0203</span><br><span class="line"></span><br><span class="line">// 需要操作这两部分 RSA 的核心原理就是两个大数相乘</span><br><span class="line">bdab976385934fb3ca17ec8775da752e191ce4ef6b5dc6398b3faf60615d45ad06e01216f8f11f4cab9e43a789b296a7bb318882bf320d2a21c00f6da233607576de16e7f6f552d97c2a4db345c97db5b5fc15127bd77ff1f1f588c577959d62694819a7eecb1f23d91c45654fbe90f300f68b64429cd4770d6685a761a1ed2d</span><br><span class="line">010001</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">modulus</span> <span class="operator">=</span> <span class="string">&quot;bdab976385934fb3ca17ec8775da752e191ce4ef6b5dc6398b3faf60615d45ad06e01216f8f11f4cab9e43a789b296a7bb318882bf320d2a21c00f6da233607576de16e7f6f552d97c2a4db345c97db5b5fc15127bd77ff1f1f588c577959d62694819a7eecb1f23d91c45654fbe90f300f68b64429cd4770d6685a761a1ed2d&quot;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">publicExponent</span> <span class="operator">=</span> <span class="string">&quot;010001&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">BigInteger</span> <span class="variable">n</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigInteger</span>(modulus, <span class="number">16</span>);</span><br><span class="line"><span class="type">BigInteger</span> <span class="variable">e</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigInteger</span>(publicExponent, <span class="number">16</span>);</span><br><span class="line"><span class="type">RSAPublicKeySpec</span> <span class="variable">spec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RSAPublicKeySpec</span>(n, e);</span><br><span class="line"><span class="type">Public</span> <span class="variable">publicKey</span> <span class="operator">=</span> keyFactory.generatePublic(spec);</span><br><span class="line"><span class="type">byte</span>[] publicBytes = publicKey.getEncoded();</span><br><span class="line">System.out.printn(Base64.getEncoded().encodeToString(pubkeyBytes));</span><br><span class="line"><span class="comment">// 这样讲两个数传入得到的仍然是base64编码的私钥，这是hex编码的转换，不是直接hex过去的</span></span><br><span class="line"><span class="comment">// 先从一个00的后面开始截取，一般是最后一个00，最后是截取一个 0203</span></span><br></pre></td></tr></table></figure>



<p>还可以利用工具转换 &#x3D;&#x3D;opensll&#x3D;&#x3D; </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 这样即可输出公钥hex的编码内容</span><br><span class="line">opensll rsa -public -in [文件] -text</span><br><span class="line"></span><br><span class="line">// 私钥</span><br><span class="line">opensll res -in [] -text</span><br></pre></td></tr></table></figure>



<p>具体的加密解密操作和base64是一样的</p>
<h4 id="RSAhook"><a href="#RSAhook" class="headerlink" title="RSAhook"></a>RSAhook</h4><p>其他的方法不用管，可以直接用之前hookDES的代码通杀hook，但是hex编码的密钥不能无脑 getEncoded了，需要进行一个判断</p>
<p>RSA的私钥无法进行 getEncoded ，这样就无法获取私钥，但是一般逆向也不需要RSA的私钥</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">des.init.overload(<span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;java.security.Key&#x27;</span>).implementation = function () &#123;</span><br><span class="line">    console.log(<span class="string">&quot;Cipher init(&#x27;int&#x27;, &#x27;java.security.Key&#x27;)&quot;</span>)</span><br><span class="line">    <span class="type">var</span> <span class="variable">algorithm</span> <span class="operator">=</span> <span class="built_in">this</span>.getAlgorithm();</span><br><span class="line">    <span class="type">var</span> <span class="variable">tag</span> <span class="operator">=</span> algorithm + <span class="string">&quot;init key&quot;</span>;</span><br><span class="line">    <span class="type">var</span> <span class="variable">className</span> <span class="operator">=</span>JSON.stringify(arguments[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">if</span>(className.indexOf(<span class="string">&quot;SecretKeySpec&quot;</span>) === -<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">key</span> <span class="operator">=</span> arguments[<span class="number">1</span>].getEncoded();</span><br><span class="line">        toBase64(tag, key);</span><br><span class="line">        toHex(tag, key);</span><br><span class="line">        toUtf8(tag, key);</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(<span class="string">&quot;================================================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.init.apply(<span class="built_in">this</span>, arguments);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="算法常见の套路"><a href="#算法常见の套路" class="headerlink" title="算法常见の套路"></a>算法常见の套路</h2><p>无论是对称加密算法还是非对称加密算法都有局限性，如果仅使用对称加密算法，使用固定的密钥的话，仅破解客户端，所有的东西都可以解密了，随机生成密钥的话，还需要传输密钥，更不安全。仅使用非对称加密算法能够加密的数据太有限了。</p>
<p>常见的套路就是AES+RSA，先随机生成AES密钥，将这个密钥进行RSA加密。得到加密密文，将数据密文和密钥密文发送给服务器。</p>
<h2 id="数字签名算法"><a href="#数字签名算法" class="headerlink" title="数字签名算法"></a>数字签名算法</h2><p>所谓数字签名算法是将信息摘要算法和RSA算法进行结合，先进行信息摘要算法，再进行非对称加密算法</p>
<p>主要作用就是用来防止发出去的数据被篡改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">我要发送数据 &quot;demo&quot; 为了防止这个数据被篡改我先加一个信息摘要MD5</span><br><span class="line">fe01ce2a7fbac8fafaed7c982a04e229</span><br><span class="line">这样还有被篡改的可能，对方可以测试我使用的什么信息摘要算法，更改数据之后，再进行摘要算法</span><br><span class="line">我就再给他一个RSA加密，使用私钥进行加密，公钥对外公开，对方可以用公钥来验证数据，这样就难以篡改了，除非我的私钥被拿到</span><br></pre></td></tr></table></figure>



<p>签名实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 私钥签名</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">MD5withRSA</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchAlgorithmException, InvalidKeySpecException, InvalidKeyException, SignatureException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">stakey</span> <span class="operator">=</span> <span class="string">&quot;MIICdgIBADANBgkqhkiG9w0BAQEFAASCAmAwggJcAgEAAoGBALaQhr6twrSiKuDD&quot;</span> +</span><br><span class="line">            <span class="string">&quot;E4z20iRb3mIY2mju2aJHwos5qnPXeRhzLRywF4gnpHjgncoRZVByuNKqQ8Z5C06s&quot;</span> +</span><br><span class="line">            <span class="string">&quot;9iXUvFfl69sOwiOYoFle7jDwWQXEJbQi1om7aqtf7e+vXiD4ldw5itwQP6XnenBD&quot;</span> +</span><br><span class="line">            <span class="string">&quot;myWzVtseoB5X4j4x9pnZdZhM1FtHAgMBAAECgYBDKOW4zZk79BBMANd3WvExWO51&quot;</span> +</span><br><span class="line">            <span class="string">&quot;LeljAsLjFPz3VK5k0RaGLRCiZhEyEEtMAG1rgXzA3IMrVGF8aNkFB1HB1wG1wC4P&quot;</span> +</span><br><span class="line">            <span class="string">&quot;t7hZl5s2tdseXsIMmS0mpDUZZu+tnFwHcqZS4K6rIFjQ8lZn7epv32Pc/0aSliWp&quot;</span> +</span><br><span class="line">            <span class="string">&quot;5II5OZG2rrcG5C+y4QJBAPDQHba3wbuirDkq1QE3qUv05RAXGurideos9audGbf7&quot;</span> +</span><br><span class="line">            <span class="string">&quot;RXu4RjiYT7xlEVdZBARL/eAu36PDZy+GTb6No5Iqn5ECQQDCE//3YVKgUbfMDLrq&quot;</span> +</span><br><span class="line">            <span class="string">&quot;2LznXk+S5NXNbj2tocKsvQJLIa29qfd3eouQpR1osCJvqmA8aV2Z90y03yFBUOmv&quot;</span> +</span><br><span class="line">            <span class="string">&quot;B5FXAkEAzyp7JYGYDQ+5EcUjUdTMtCeOF/WIlqETx82921FfmsNz1yeEYZPGpNBd&quot;</span> +</span><br><span class="line">            <span class="string">&quot;xsMxjXDCi2ZHxt6Hmn7zywaWvVwlwQJALFNVCrL3pBYF3Fyr9Cc8PbuUgQAytJCR&quot;</span> +</span><br><span class="line">            <span class="string">&quot;Fa70P2+Lro0qmT7QfkFGzupnJRnVQ5uuDx4heqC4rDap6bkJJiicUQJAfWRkNXyX&quot;</span> +</span><br><span class="line">            <span class="string">&quot;WFvfM04BMjWSBgBOUmAVyB8GFAGh3e4uUvZYIr9oAnzdErFLDdXUyl1uCw5qrYkj&quot;</span> +</span><br><span class="line">            <span class="string">&quot;hM7Kq5Lkby/iaw==&quot;</span>;</span><br><span class="line">    <span class="type">byte</span>[] staKeyBytes = ByteString.decodeBase64(stakey).toByteArray();</span><br><span class="line">    <span class="type">PKCS8EncodedKeySpec</span> <span class="variable">staKeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PKCS8EncodedKeySpec</span>(staKeyBytes);</span><br><span class="line">    <span class="type">KeyFactory</span> <span class="variable">staKeyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">    <span class="type">PrivateKey</span> <span class="variable">privateKey</span> <span class="operator">=</span> staKeyFactory.generatePrivate(staKeySpec);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 上面就是处理私钥的不用管</span></span><br><span class="line">    <span class="comment">// 指定签名算法</span></span><br><span class="line">    <span class="type">Signature</span> <span class="variable">sig</span> <span class="operator">=</span> Signature.getInstance(<span class="string">&quot;SHA256withRSA&quot;</span>);</span><br><span class="line">    <span class="comment">// 导入私钥</span></span><br><span class="line">    sig.initSign(privateKey);</span><br><span class="line">    <span class="comment">// 加密明文数据的字节数组</span></span><br><span class="line">    sig.update(<span class="string">&quot;demo&quot;</span>.getBytes());</span><br><span class="line">    <span class="comment">// 得到结果，值得注意的是，签名算法要保证运行结果不变的，所以填充是NOPadding</span></span><br><span class="line">    <span class="type">byte</span>[] signResult = sig.sign();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>验证实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">   <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC2kIa+rcK0oirgwxOM9tIkW95i\n&quot;</span> +</span><br><span class="line">           <span class="string">&quot;GNpo7tmiR8KLOapz13kYcy0csBeIJ6R44J3KEWVQcrjSqkPGeQtOrPYl1LxX5evb\n&quot;</span> +</span><br><span class="line">           <span class="string">&quot;DsIjmKBZXu4w8FkFxCW0ItaJu2qrX+3vr14g+JXcOYrcED+l53pwQ5sls1bbHqAe\n&quot;</span> +</span><br><span class="line">           <span class="string">&quot;V+I+MfaZ2XWYTNRbRwIDAQAB&quot;</span>;</span><br><span class="line">   <span class="type">byte</span>[] keyBytes = ByteString.decodeBase64(key).toByteArray();</span><br><span class="line">   <span class="type">X509EncodedKeySpec</span> <span class="variable">keySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">X509EncodedKeySpec</span>(keyBytes);</span><br><span class="line">   <span class="type">KeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">   <span class="type">PublicKey</span> <span class="variable">publicKey</span> <span class="operator">=</span> keyFactory.generatePublic(keySpec);</span><br><span class="line"></span><br><span class="line"><span class="type">Signature</span> <span class="variable">sig</span> <span class="operator">=</span> Signature.getInstance(<span class="string">&quot;SHA256withRSA&quot;</span>);</span><br><span class="line"><span class="comment">// 导入公钥</span></span><br><span class="line">   sig.initVerify(publicKey);</span><br><span class="line"><span class="comment">// 导入明文</span></span><br><span class="line">   sig.update(<span class="string">&quot;demo&quot;</span>.getBytes());</span><br><span class="line"><span class="comment">// 将给到密文传入，验证是否正确，返回布尔类型</span></span><br><span class="line">   <span class="type">boolean</span> <span class="variable">isTrue</span> <span class="operator">=</span> sig.verify(signResult);</span><br><span class="line">   System.out.println(isTrue);</span><br></pre></td></tr></table></figure>



<p>这个签名算法的结果是加密之后前面，将信息摘要算法的结果放在最后面，然后在前面填充东西，具体填充的啥还不知道</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">RSAwithRSA</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchAlgorithmException, InvalidKeySpecException, InvalidKeyException, SignatureException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">stakey</span> <span class="operator">=</span> <span class="string">&quot;MIICdgIBADANBgkqhkiG9w0BAQEFAASCAmAwggJcAgEAAoGBALaQhr6twrSiKuDD&quot;</span> +</span><br><span class="line">            <span class="string">&quot;E4z20iRb3mIY2mju2aJHwos5qnPXeRhzLRywF4gnpHjgncoRZVByuNKqQ8Z5C06s&quot;</span> +</span><br><span class="line">            <span class="string">&quot;9iXUvFfl69sOwiOYoFle7jDwWQXEJbQi1om7aqtf7e+vXiD4ldw5itwQP6XnenBD&quot;</span> +</span><br><span class="line">            <span class="string">&quot;myWzVtseoB5X4j4x9pnZdZhM1FtHAgMBAAECgYBDKOW4zZk79BBMANd3WvExWO51&quot;</span> +</span><br><span class="line">            <span class="string">&quot;LeljAsLjFPz3VK5k0RaGLRCiZhEyEEtMAG1rgXzA3IMrVGF8aNkFB1HB1wG1wC4P&quot;</span> +</span><br><span class="line">            <span class="string">&quot;t7hZl5s2tdseXsIMmS0mpDUZZu+tnFwHcqZS4K6rIFjQ8lZn7epv32Pc/0aSliWp&quot;</span> +</span><br><span class="line">            <span class="string">&quot;5II5OZG2rrcG5C+y4QJBAPDQHba3wbuirDkq1QE3qUv05RAXGurideos9audGbf7&quot;</span> +</span><br><span class="line">            <span class="string">&quot;RXu4RjiYT7xlEVdZBARL/eAu36PDZy+GTb6No5Iqn5ECQQDCE//3YVKgUbfMDLrq&quot;</span> +</span><br><span class="line">            <span class="string">&quot;2LznXk+S5NXNbj2tocKsvQJLIa29qfd3eouQpR1osCJvqmA8aV2Z90y03yFBUOmv&quot;</span> +</span><br><span class="line">            <span class="string">&quot;B5FXAkEAzyp7JYGYDQ+5EcUjUdTMtCeOF/WIlqETx82921FfmsNz1yeEYZPGpNBd&quot;</span> +</span><br><span class="line">            <span class="string">&quot;xsMxjXDCi2ZHxt6Hmn7zywaWvVwlwQJALFNVCrL3pBYF3Fyr9Cc8PbuUgQAytJCR&quot;</span> +</span><br><span class="line">            <span class="string">&quot;Fa70P2+Lro0qmT7QfkFGzupnJRnVQ5uuDx4heqC4rDap6bkJJiicUQJAfWRkNXyX&quot;</span> +</span><br><span class="line">            <span class="string">&quot;WFvfM04BMjWSBgBOUmAVyB8GFAGh3e4uUvZYIr9oAnzdErFLDdXUyl1uCw5qrYkj&quot;</span> +</span><br><span class="line">            <span class="string">&quot;hM7Kq5Lkby/iaw==&quot;</span>;</span><br><span class="line">    <span class="type">byte</span>[] staKeyBytes = ByteString.decodeBase64(stakey).toByteArray();</span><br><span class="line">    <span class="type">PKCS8EncodedKeySpec</span> <span class="variable">staKeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PKCS8EncodedKeySpec</span>(staKeyBytes);</span><br><span class="line">    <span class="type">KeyFactory</span> <span class="variable">staKeyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">    <span class="type">PrivateKey</span> <span class="variable">privateKey</span> <span class="operator">=</span> staKeyFactory.generatePrivate(staKeySpec);</span><br><span class="line"></span><br><span class="line">    <span class="type">Signature</span> <span class="variable">sig</span> <span class="operator">=</span> Signature.getInstance(<span class="string">&quot;SHA256withRSA&quot;</span>);</span><br><span class="line">    sig.initSign(privateKey);</span><br><span class="line">    sig.update(<span class="string">&quot;demo&quot;</span>.getBytes());</span><br><span class="line">    <span class="type">byte</span>[] signResult = sig.sign();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC2kIa+rcK0oirgwxOM9tIkW95i\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;GNpo7tmiR8KLOapz13kYcy0csBeIJ6R44J3KEWVQcrjSqkPGeQtOrPYl1LxX5evb\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;DsIjmKBZXu4w8FkFxCW0ItaJu2qrX+3vr14g+JXcOYrcED+l53pwQ5sls1bbHqAe\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;V+I+MfaZ2XWYTNRbRwIDAQAB&quot;</span>;</span><br><span class="line">    <span class="type">byte</span>[] keyBytes = ByteString.decodeBase64(key).toByteArray();</span><br><span class="line">    <span class="type">X509EncodedKeySpec</span> <span class="variable">keySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">X509EncodedKeySpec</span>(keyBytes);</span><br><span class="line">    <span class="type">KeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">    <span class="type">PublicKey</span> <span class="variable">publicKey</span> <span class="operator">=</span> keyFactory.generatePublic(keySpec);</span><br><span class="line"></span><br><span class="line">    sig.initVerify(publicKey);</span><br><span class="line">    sig.update(<span class="string">&quot;demo&quot;</span>.getBytes());</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isTrue</span> <span class="operator">=</span> sig.verify(signResult);</span><br><span class="line">    System.out.println(isTrue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="数字签名算法hook通杀"><a href="#数字签名算法hook通杀" class="headerlink" title="数字签名算法hook通杀"></a>数字签名算法hook通杀</h3><p>从实现可以看出，可hook的方法有 &#x3D;&#x3D;getPrivateKey&#x3D;&#x3D; 、initSign、 update、 sign、initVerify、verify </p>
<p>hook update方法获取明文</p>
<p>hook  sign方法获取密文</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hook数字签名算法</span></span><br><span class="line"><span class="comment">// hook update方法，获取签名前的数据</span></span><br><span class="line"><span class="keyword">var</span> signature = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.security.Signature&quot;</span>)</span><br><span class="line">signature.<span class="property">update</span>.<span class="title function_">overload</span>(<span class="string">&#x27;byte&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Signature update(&#x27;byte)&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;===============================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(data);</span><br><span class="line">&#125;</span><br><span class="line">signature.<span class="property">update</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.nio.ByteBuffer&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Signature update(&#x27;java.nio.ByteBuffer&#x27;)&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;===============================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(data);</span><br><span class="line">&#125;</span><br><span class="line">signature.<span class="property">update</span>.<span class="title function_">overload</span>(<span class="string">&#x27;[B&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Signature update(&#x27;[B&#x27;)&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>();</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot; Signature update(&#x27;[B&#x27;)&quot;</span>;</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, data);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, data);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, data);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;===============================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 其实着重hook下面这个方法就够了，上面的byte数组需要走下面这个方法</span></span><br><span class="line">signature.<span class="property">update</span>.<span class="title function_">overload</span>(<span class="string">&#x27;[B&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;int&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">data, start, len</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Signature update(&#x27;[B&#x27;, &#x27;int&#x27;, &#x27;int&#x27;)&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>();</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot; Signature update(&#x27;[B&#x27;, &#x27;int&#x27;, &#x27;int&#x27;)&quot;</span>;</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, data);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, data);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, data);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;===============================================&quot;</span>, start, len);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(data, start, len);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// hook sign方法，获取签名密文</span></span><br><span class="line">signature.<span class="property">sign</span>.<span class="title function_">overload</span>(<span class="string">&#x27;[B&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;int&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Signature sign(&#x27;[B&#x27;, &#x27;int&#x27;, &#x27;int&#x27;)&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;===============================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">sign</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line">signature.<span class="property">sign</span>.<span class="title function_">overload</span>().<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Signature sign()&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="title function_">sign</span>();</span><br><span class="line">    <span class="keyword">var</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>();</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot; Signature sign()&quot;</span>;</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, result);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, result);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, result);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;===============================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src="/../%E5%9B%BE%E7%89%87/image-20241117195958891.png" alt="image-20241117195958891"></p>
<p>verify 方法能获取密文，已经获取到了，再hook起来没有什么意义</p>
<p>initSign和initVerify方法可以获取到 公钥和私钥</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hook initSign方法，获取签名私钥</span></span><br><span class="line">signature.<span class="property">initSign</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.security.PrivateKey&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Signature initSign(&#x27;java.security.PrivateKey&#x27;)&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>();</span><br><span class="line">    <span class="keyword">var</span> tag = algorithm + <span class="string">&quot; Signature initSign()&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">OpenSSLRSAPrivateKey</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.android.org.conscrypt.OpenSSLRSAPrivateKey&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> realkey = <span class="title class_">Java</span>.<span class="title function_">cast</span>(key, <span class="title class_">OpenSSLRSAPrivateKey</span>).<span class="title function_">getEncoded</span>();</span><br><span class="line">    <span class="title function_">toBase64</span>(tag, realkey);</span><br><span class="line">    <span class="title function_">toHex</span>(tag, realkey);</span><br><span class="line">    <span class="title function_">toUtf8</span>(tag, realkey);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;================================================&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">initSign</span>(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这个密钥是不能直接获取，因为传入的是PrivateKey类 ，PrivateKey 是一个接口，没有像之前一样的 getEncoded 方法，所以需要做一个多态转型，来获取，而且只能获取到base64的，不能获取到hex的密钥，有用处但是用处不大</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241118163848199.png" alt="image-20241118163848199"></p>
</blockquote>
<h2 id="CryptoJS"><a href="#CryptoJS" class="headerlink" title="CryptoJS"></a>CryptoJS</h2><p>学一下JS的加解密，因为可能要复现某算法，使用JS脚本来hook复现比较方便，而且被其他语言调用也比较方便</p>
<p>使用CryptoJS来实现信息摘要算法和对称加密算法</p>
<h3 id="信息摘要算法的实现"><a href="#信息摘要算法的实现" class="headerlink" title="信息摘要算法的实现"></a>信息摘要算法的实现</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cryptoJS = <span class="built_in">require</span>(<span class="string">&#x27;crypto-js&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> demo = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> key = <span class="string">&quot;demo&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;MD5：&quot;</span> + cryptoJS.<span class="title class_">MD5</span>(demo).<span class="title function_">toString</span>());</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HmacMD5：&quot;</span> + cryptoJS.<span class="title class_">HmacMD5</span>(demo, key).<span class="title function_">toString</span>())</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;SHA1：&quot;</span> + cryptoJS.<span class="title class_">SHA1</span>(demo).<span class="title function_">toString</span>())</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HmacSHA1：&quot;</span> + cryptoJS.<span class="title class_">HmacSHA1</span>(demo, key).<span class="title function_">toString</span>())</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;SHA256：&quot;</span> + cryptoJS.<span class="title class_">SHA256</span>(demo).<span class="title function_">toString</span>())</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HmacSHA256：&quot;</span> + cryptoJS.<span class="title class_">HmacSHA256</span>(demo, key).<span class="title function_">toString</span>())</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;SHA512：&quot;</span> + cryptoJS.<span class="title class_">SHA512</span>(demo).<span class="title function_">toString</span>())</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HmacSHA512：&quot;</span> + cryptoJS.<span class="title class_">HmacSHA512</span>(demo, key).<span class="title function_">toString</span>())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="title class_">MD5</span>：e10adc3949ba59abbe56e057f20f883e</span><br><span class="line"><span class="title class_">HmacMD5</span>：e8649f37712cdad94724b22154e4b83b</span><br><span class="line"><span class="title class_">SHA1</span>：7c4a8d09ca3762af61e59520943dc26494f8941b</span><br><span class="line"><span class="title class_">HmacSHA1</span>：8a497921f4d842b57f6e054cee4fd2d91577815a</span><br><span class="line"><span class="title class_">SHA256</span>：8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92</span><br><span class="line"><span class="title class_">HmacSHA256</span>：1b8e71ff0087551bb6f063b15ea850650ddbdf6a02e5e81c2a981b91efafebdd</span><br><span class="line"><span class="title class_">SHA512</span>：ba3253876aed6bc22d4a6ff53d8406c6ad864195ed144ab5c87621b6c233b548baeae6956df346ec8c17f5ea10f35ee3cbc514797ed7ddd3145464e2a0bab413</span><br><span class="line"><span class="title class_">HmacSHA512</span>：14f04320d0a4a21ed7517b94a8cf219f3e674fa95dd6281d5b61e3fc2e52a5567468e3ef4b4ace6edbecd6aa809f012606e482c367bbb7c285278a1bb3a0008d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不加toString 输出的形式是 wordArray</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">words</span>: [ -<span class="number">519381959</span>, <span class="number">1236949419</span>, -<span class="number">1101602729</span>, -<span class="number">233863106</span> ],</span><br><span class="line">  <span class="attr">sigBytes</span>: <span class="number">16</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 用一个字符串+ 后面的东西，即使没有toString也没问题，也是字符串形式，自动转换了就</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;MD5：&quot;</span> + cryptoJS.<span class="title class_">MD5</span>(demo))</span><br></pre></td></tr></table></figure>



<p>也存在一种，冗长，难写，复杂的实现形式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hasher = cryptoJS.<span class="property">algo</span>.<span class="property">SHA256</span>.<span class="title function_">create</span>();</span><br><span class="line"><span class="comment">// reset是清空内容</span></span><br><span class="line">hasher.<span class="title function_">reset</span>();</span><br><span class="line"><span class="comment">// update是添加内容，可以多次添加</span></span><br><span class="line">hasher.<span class="title function_">update</span>(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">hasher.<span class="title function_">update</span>(<span class="string">&quot;789&quot;</span>);</span><br><span class="line"><span class="comment">// 进行加密</span></span><br><span class="line"><span class="keyword">var</span> hash = hasher.<span class="title function_">finalize</span>().<span class="title function_">toString</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hash);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hmac还需要指定密钥</span></span><br><span class="line"><span class="keyword">var</span> hasherHmac = cryptoJS.<span class="property">algo</span>.<span class="property">HMAC</span>.<span class="title function_">create</span>(cryptoJS.<span class="property">algo</span>.<span class="property">SHA256</span>, <span class="string">&quot;demo&quot;</span>);</span><br><span class="line">hasherHmac.<span class="title function_">reset</span>();</span><br><span class="line">hasherHmac.<span class="title function_">update</span>(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">hasherHmac.<span class="title function_">update</span>(<span class="string">&quot;789&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> hmac = hasherHmac.<span class="title function_">finalize</span>().<span class="title function_">toString</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hmac);</span><br></pre></td></tr></table></figure>

<p><img src="/../%E5%9B%BE%E7%89%87/image-20241117205858280.png" alt="image-20241117205858280"></p>
<blockquote>
<p>怎么说呢，放着简单的不用，用复杂的干啥呢</p>
</blockquote>
<h3 id="字符串解析"><a href="#字符串解析" class="headerlink" title="字符串解析"></a>字符串解析</h3><p>在Java中字符串解析是转换成 base64或者hex或者UTF-8，在JS中当然没什么不一样了，换个写法而已</p>
<p>哦，说一下之前的wordArray</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">words</span>: [ -<span class="number">519381959</span>, <span class="number">1236949419</span>, -<span class="number">1101602729</span>, -<span class="number">233863106</span> ],</span><br><span class="line">  <span class="attr">sigBytes</span>: <span class="number">16</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">这个words是一个类似于字节数组的东西，将四个字节变成了一个整数，也可以理解成字节数组，反正就是存这个的</span><br></pre></td></tr></table></figure>



<h4 id="String转wordArray"><a href="#String转wordArray" class="headerlink" title="String转wordArray"></a>String转wordArray</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这个就相当于Java中的 getBytes() 方法</span></span><br><span class="line">cryptoJS.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(utf8ToString)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 就是HEX解码</span></span><br><span class="line">cryptoJS.<span class="property">enc</span>.<span class="property">Hex</span>.<span class="title function_">parse</span>(hexToString)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 就是base64解码</span></span><br><span class="line">cryptoJS.<span class="property">enc</span>.<span class="property">Base64</span>.<span class="title function_">parse</span>(base64ToString)</span><br></pre></td></tr></table></figure>

<p><img src="/../%E5%9B%BE%E7%89%87/image-20241117211621418.png" alt="image-20241117211621418"></p>
<h4 id="wordArray转String"><a href="#wordArray转String" class="headerlink" title="wordArray转String"></a>wordArray转String</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wordArray转string</span></span><br><span class="line"><span class="keyword">let</span> wordArray = cryptoJS.<span class="title class_">MD5</span>(<span class="string">&quot;123456&quot;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(wordArray)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(wordArray + <span class="string">&#x27;&#x27;</span>)		<span class="comment">// 强转</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(wordArray.<span class="title function_">toString</span>())</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(wordArray.<span class="title function_">toString</span>(cryptoJS.<span class="property">enc</span>.<span class="property">Hex</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(wordArray.<span class="title function_">toString</span>(cryptoJS.<span class="property">enc</span>.<span class="property">Base64</span>))</span><br><span class="line"><span class="comment">// console.log(wordArray.toString(cryptoJS.enc.Utf8))</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cryptoJS.<span class="property">enc</span>.<span class="property">Hex</span>.<span class="title function_">stringify</span>(wordArray))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cryptoJS.<span class="property">enc</span>.<span class="property">Base64</span>.<span class="title function_">stringify</span>(wordArray))</span><br><span class="line"><span class="comment">// cryptoJS.enc.Utf8.stringify(wordArray)</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>转UTF-8有报错，知道就行了，可以看到toString方法默认的是转成HEX编码</p>
<p>注意这个转base64是将字符数组转base64不是将hex转成base64编码，那样会变得很长，很显然这并没有发生</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241117212032481.png" alt="image-20241117212032481"></p>
<p>这些的用处在于有时候得到的数据千奇百怪，需要各种处理，比如得到hex编码的明文</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 如果直接这样操作的话，是当作utf8来解析的</span><br><span class="line">var mdhex = &quot;313233343536&quot;</span><br><span class="line">console.log(cryptoJS.MD5(mdhex).toString())</span><br><span class="line"></span><br><span class="line">// 这个时候就需要转换</span><br><span class="line">var mdhex = &quot;313233343536&quot;</span><br><span class="line">console.log(cryptoJS.MD5(cryptoJS.enc.Hex.parse(mdhex)).toString())</span><br></pre></td></tr></table></figure>

<p><img src="/../%E5%9B%BE%E7%89%87/image-20241117212918100.png" alt="image-20241117212918100"></p>
</blockquote>
<h3 id="对称加密算法-1"><a href="#对称加密算法-1" class="headerlink" title="对称加密算法"></a>对称加密算法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对称加密算法</span></span><br><span class="line"><span class="comment">// 不同算法的key长度和iv长度也不一样，就不进行初始化了，看一下格式就行，具体使用具体查找</span></span><br><span class="line"><span class="comment">// cfg一般包含加密模式、填充方式（PKcs7最常用和Java模式中的PKCS5结果一样）</span></span><br><span class="line"><span class="keyword">var</span> cfg = &#123;</span><br><span class="line">    <span class="attr">iv</span>: iv,</span><br><span class="line">    <span class="attr">mode</span>: cryptoJS.<span class="property">mode</span>.<span class="property">CBC</span>,</span><br><span class="line">    <span class="attr">padding</span>: cryptoJS.<span class="property">pad</span>.<span class="property">Pkcs7</span>,</span><br><span class="line">    <span class="attr">format</span>: cryptoJS.<span class="property">format</span>.<span class="property">Hex</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> ciphertext = cryptoJS.<span class="property">DES</span>.<span class="title function_">encrypt</span>(message, key, cfg)</span><br><span class="line"><span class="keyword">var</span> plaintext = cryptoJS.<span class="property">DES</span>.<span class="title function_">decrypt</span>(ciphertext, key, cfg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ciphertext = cryptoJS.<span class="property">TripleDES</span>.<span class="title function_">encrypt</span>(message, key, cfg)</span><br><span class="line"><span class="keyword">var</span> plaintext = cryptoJS.<span class="property">TripleDES</span>.<span class="title function_">decrypt</span>(ciphertext, key, cfg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ciphertext = cryptoJS.<span class="property">AES</span>.<span class="title function_">encrypt</span>(message, key, cfg)</span><br><span class="line"><span class="keyword">var</span> plaintext = cryptoJS.<span class="property">AES</span>.<span class="title function_">decrypt</span>(ciphertext, key, cfg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ciphertext = cryptoJS.<span class="property">RC4</span>.<span class="title function_">encrypt</span>(message, key, cfg)</span><br><span class="line"><span class="keyword">var</span> plaintext = cryptoJS.<span class="property">RC4</span>.<span class="title function_">decrypt</span>(ciphertext, key, cfg)</span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 进行AES加密，iv和key都需要解析</span></span><br><span class="line"><span class="keyword">var</span> hexKeyBytes = cryptoJS.<span class="property">enc</span>.<span class="property">Hex</span>.<span class="title function_">parse</span>(<span class="string">&quot;0123456789ABCDEF&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> hexIvBytes = cryptoJS.<span class="property">enc</span>.<span class="property">Hex</span>.<span class="title function_">parse</span>(<span class="string">&quot;0123456789ABCDEF&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// cfg中不传mode和padding是默认的CBC/PKcs7的形式，format中可以定义格式化输出</span></span><br><span class="line"><span class="keyword">var</span> cfg = &#123;</span><br><span class="line">    <span class="attr">iv</span>: hexIvBytes,</span><br><span class="line">    <span class="attr">mode</span>: cryptoJS.<span class="property">mode</span>.<span class="property">CBC</span>,</span><br><span class="line">    <span class="attr">padding</span>: cryptoJS.<span class="property">pad</span>.<span class="property">Pkcs7</span>,</span><br><span class="line">    <span class="attr">format</span>: cryptoJS.<span class="property">format</span>.<span class="property">Hex</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> encrypted = cryptoJS.<span class="property">AES</span>.<span class="title function_">encrypt</span>(<span class="string">&quot;123456&quot;</span>, hexKeyBytes, cfg);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 得到的这个 encrypted 是一个对象，加密的wordArray内容在 ciphertext 中</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(encrypted.<span class="property">ciphertext</span>.<span class="title function_">toString</span>());</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：cfg中不指定输出形式的话，encrypted 默认以Base64的形式输出</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241118164530869.png" alt="image-20241118164530869"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果直接这样输出是会报错的</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(encrypted.<span class="title function_">toString</span>(cryptoJS.<span class="property">enc</span>.<span class="property">Base64</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hex则是无输出</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(encrypted.<span class="title function_">toString</span>(cryptoJS.<span class="property">enc</span>.<span class="property">Hex</span>));</span><br></pre></td></tr></table></figure>



<p>format属性中还可以夹带私货，自定义输出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cfg = &#123;</span><br><span class="line"> <span class="attr">iv</span>: hexIvBytes,</span><br><span class="line"> <span class="attr">mode</span>: cryptoJS.<span class="property">mode</span>.<span class="property">CBC</span>,</span><br><span class="line"> <span class="attr">padding</span>: cryptoJS.<span class="property">pad</span>.<span class="property">Pkcs7</span>,</span><br><span class="line"> <span class="attr">format</span>: &#123;</span><br><span class="line">     <span class="attr">stringify</span>: <span class="keyword">function</span> (<span class="params">data</span>)&#123;</span><br><span class="line">         <span class="keyword">let</span> e = &#123;</span><br><span class="line">             <span class="attr">ct</span>: data.<span class="property">ciphertext</span>.<span class="title function_">toString</span>(),</span><br><span class="line">             <span class="attr">miaoshu</span>: <span class="string">&quot;这是自定义的输出&quot;</span></span><br><span class="line">         &#125;；</span><br><span class="line">         <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(e)</span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="comment">// 定义parse是解密使用的</span></span><br><span class="line">     <span class="attr">parse</span>: <span class="keyword">function</span> (<span class="params">data</span>)&#123;</span><br><span class="line">         <span class="comment">// 解析自己写的JSON</span></span><br><span class="line">         <span class="keyword">let</span> json = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data)</span><br><span class="line">         <span class="comment">// json.ct获取加密后的数据，以为是hex的形式，使用hex解析，再进行create创建，返回</span></span><br><span class="line">         <span class="keyword">let</span> newVar = cryptoJS.<span class="property">lib</span>.<span class="property">CipherParams</span>.<span class="title function_">create</span>(&#123;<span class="attr">ciphertext</span>: cryptoJS.<span class="property">enc</span>.<span class="property">Hex</span>.<span class="title function_">parse</span>(json.<span class="property">ct</span>)&#125;);</span><br><span class="line">         <span class="keyword">return</span> newVar</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/../%E5%9B%BE%E7%89%87/image-20241118165839649.png" alt="image-20241118165839649"></p>
</blockquote>
<p>解密也没啥难度，不写了</p>
<h3 id="其他算法"><a href="#其他算法" class="headerlink" title="其他算法"></a>其他算法</h3><h4 id="RIPEMD160-和-HmacRIPEMD160"><a href="#RIPEMD160-和-HmacRIPEMD160" class="headerlink" title="RIPEMD160 和 HmacRIPEMD160"></a>RIPEMD160 和 HmacRIPEMD160</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RIPEMD160 一种信息摘要算法</span></span><br><span class="line"><span class="comment">// 有两种形式，一种没有密钥--RIPEMD160 </span></span><br><span class="line"><span class="comment">// 一种有密钥--HmacRIPEMD160</span></span><br><span class="line"><span class="comment">// 加密结果有40个十六进制字符</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ripemd160 = cryptoJS.<span class="title class_">RIPEMD160</span>(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ripemd160 + <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> hmacRIPEMD160 = cryptoJS.<span class="title class_">HmacRIPEMD160</span>(<span class="string">&quot;123456&quot;</span>, <span class="string">&quot;demo&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hmacRIPEMD160 + <span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/../%E5%9B%BE%E7%89%87/image-20241118184812571.png" alt="image-20241118184812571"></p>
<h4 id="PBKDF2-和-EvpKDF"><a href="#PBKDF2-和-EvpKDF" class="headerlink" title="PBKDF2 和 EvpKDF"></a>PBKDF2 和 EvpKDF</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PBKDF2</span></span><br><span class="line"><span class="comment">// keySize大小设定为 4/8/16 对应输出结果位数是 128/256/512</span></span><br><span class="line"><span class="comment">// iterations 表示迭代次数，这种算法的安全性随迭代次数增加而增加</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">PBKDF2</span> = cryptoJS.<span class="title class_">PBKDF2</span>(<span class="string">&quot;123456&quot;</span>, <span class="string">&quot;demo&quot;</span>, &#123; <span class="attr">keySize</span>: <span class="number">8</span>, <span class="attr">iterations</span>: <span class="number">1000</span> &#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">PBKDF2</span> + <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment">// EvpKDF</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">EvpKDF</span> = cryptoJS.<span class="title class_">EvpKDF</span>(<span class="string">&quot;123456&quot;</span>, <span class="string">&quot;demo&quot;</span>, &#123; <span class="attr">keySize</span>: <span class="number">8</span>, <span class="attr">iterations</span>: <span class="number">1000</span> &#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">EvpKDF</span> + <span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/../%E5%9B%BE%E7%89%87/image-20241118185931951.png" alt="image-20241118185931951"></p>
<h2 id="jsencrypt"><a href="#jsencrypt" class="headerlink" title="jsencrypt"></a>jsencrypt</h2><h3 id="非对称加密算法-1"><a href="#非对称加密算法-1" class="headerlink" title="非对称加密算法"></a>非对称加密算法</h3><p>非对称加密算法（RSA）CryptoJS没有，使用jsencrypt库来实现。</p>
<p>这个库是服务于web开发的，纯JS可能有问题</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">JSEncrypt</span> = <span class="built_in">require</span>(<span class="string">&#x27;jsencrypt&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个密钥可以不加头不换行的，直接一个字符串进去</span></span><br><span class="line"><span class="keyword">var</span> publicKey = <span class="string">&quot;-----BEGIN PUBLIC KEY-----\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC9zDcwxIE6ivfU821isEn0jpQM\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;l+sSK+DA5fJYKEkaGUyOWyxLt2E89+wJx80Ezn2R62kK/NzQ84ZHH8bRG2P7upZ7\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;LkYCDg+9EzmWzbPPIeSiTv5jHOFGCSmlC58S45eq5WBf8qU2haa50x004m87iW4S\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;TrpCuA0mPjXP/ZkjcQIDAQAB\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;-----END PUBLIC KEY-----&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> privateKey = <span class="string">&quot;-----BEGIN RSA PRIVATE KEY-----\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;MIICdQIBADANBgkqhkiG9w0BAQEFAASCAl8wggJbAgEAAoGBAL3MNzDEgTqK99Tz\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;bWKwSfSOlAyX6xIr4MDl8lgoSRoZTI5bLEu3YTz37AnHzQTOfZHraQr83NDzhkcf\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;xtEbY/u6lnsuRgIOD70TOZbNs88h5KJO/mMc4UYJKaULnxLjl6rlYF/ypTaFprnT\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;HTTibzuJbhJOukK4DSY+Nc/9mSNxAgMBAAECgYBPNCqP8mEPYjDcMB2kwnaKVPmZ\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;a8hQU/k95nfErEMdXhNhkNCiZEty2u8ogbWf3N/wBfJXAIDRvd56Tdt1Jd4J1UJ+\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;osHNkmWfx9ld6GYWkN8JRFGjI8Gj3FTNKqWhWCTlnpvWsyyK4F6aCHIWD6f211lk\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;u6H1+r/q9zjvu1rNhQJBAOwTn38twXyW7CumZKfqtaBJfnhKOvVmDMyGia02oOx1\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;ZVL9stsoYKCC/RxcBEi6E3ZfQOeDyBGxN5UxCiojyMsCQQDN0L9sG2KJHHa7BuwA\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;lkXDVs6geE+a4SdNbHSp5JMfUPID7ul+r0wlnpljD7g3s/2+TkpqUseMiNPs5Hhb\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;GwkzAkBDyTapC/hcz/Esb3DDjm9sgO3hmF7pi83tBEyQAfmfK+5WMCalKyjjrfkD\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;paBNSbDA8oTudTaDbgFpw1UJ2JCVAkBxqlGtgMpAcunXjJEWGefZY72lvgwouyQb\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;jEQ597SQ3QFrzqxBfMqPFDIeFXZlvQ/r5A0Q/zqZkI+KCvu1RQ8lAkAZEhjGasXX\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;SNZuX0FZzcAUEs/rkhrPL4pqNg5XXda/nzYHdxdPVMsgv8A3RSKBc7P+2wMrB075\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;yCszbgV/ovWx\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;-----END PRIVATE KEY-----&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 加密</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setEncrypt</span> (msg) &#123;</span><br><span class="line">    <span class="comment">// 获取 JSEncrypt 对象</span></span><br><span class="line">    <span class="keyword">const</span> jsencrypt = <span class="keyword">new</span> <span class="title class_">JSEncrypt</span>();</span><br><span class="line">    <span class="comment">// 初始化公钥</span></span><br><span class="line">    jsencrypt.<span class="title function_">setPublicKey</span>(publicKey);</span><br><span class="line">    <span class="comment">// 返回加密结果</span></span><br><span class="line">    <span class="keyword">return</span> jsencrypt.<span class="title function_">encrypt</span>(msg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">setEncrypt</span>(<span class="string">&quot;123456&quot;</span>));</span><br></pre></td></tr></table></figure>



<p>解决这个报错</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241118195155371.png" alt="image-20241118195155371"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">windows = global;</span><br><span class="line">或者</span><br><span class="line">var windows = global;</span><br></pre></td></tr></table></figure>

<p><img src="/../%E5%9B%BE%E7%89%87/image-20241118195128484.png" alt="image-20241118195128484"></p>
<p>还有这个报错</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241118195326505.png" alt="image-20241118195326505"></p>
<p>这个报错是由于错误的引用导致的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">JSEncrypt</span> = <span class="built_in">require</span>(<span class="string">&#x27;jsencrypt&#x27;</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>虽然底下这俩和cryptoJS一样冒绿光，但是就是报错，很奇怪</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241118195526753.png" alt="image-20241118195526753"></p>
</blockquote>
<p>调教好之后运行</p>
<p>看结果很明显是 PKCS1Padding 的填充，如果想使用其他填充模式，就需要一些操作了</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241118195657998.png" alt="image-20241118195657998"></p>
<h3 id="JSEncrypt添加NOPadding填充"><a href="#JSEncrypt添加NOPadding填充" class="headerlink" title="JSEncrypt添加NOPadding填充"></a>JSEncrypt添加NOPadding填充</h3><p>之前了解到NOPadding的填充是在明文前面填充字节0，如果我想实现的话就可以进行手动填充</p>
<p>打个断点进去</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241118201358518-1732016006152-1.png" alt="image-20241118201358518"></p>
<p>结果在这直接return了，从这里进去</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241118201651343-1732016006152-2.png" alt="image-20241118201651343"></p>
<p>导出了一个方法,这个方法是用来将 hex 的十六进制数据转换成 base64 编码</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241118202056572-1732016006153-3.png" alt="image-20241118202056572"></p>
<p>继续进,getkey 方法是检验之前是否传入了key，不管，继续</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241118202319995-1732016006153-4.png" alt="image-20241118202319995"></p>
<p>进入加密方法，这个是关键方法</p>
<p>maxLength 是检测最大字符长度，不用管他，PKSC1Padding 和 NOPadding 都需要这个数</p>
<p>经过 pkcs2 处理后进行判断是否有内容，有内容就进行加密，然后进行hex编码，再进行hex转base64将结果返回。</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241118202631605-1732016006153-5.png" alt="image-20241118202631605"></p>
<p>这里就直接进PKSC1模式进行加密了，可以在这里加一个判断，让用户多传进来一个字符串，来判断模式，这样就可以二者兼得</p>
<p>开始尝试，依照pkcs写Nopadding照葫芦画瓢了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NOPadding (type1, byte[0]) pad input string s to n byte[n] array, and return a bigint</span></span><br><span class="line"><span class="comment">// 入乡随俗了老铁</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">nopkcs</span>(<span class="params">s, n</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; s.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Message too long for RSA&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> ba = [];</span><br><span class="line">    <span class="keyword">var</span> i = s.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &gt;= <span class="number">0</span> &amp;&amp; n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> c = s.<span class="title function_">charCodeAt</span>(i--);</span><br><span class="line">        <span class="keyword">if</span> (c &lt; <span class="number">128</span>) &#123; <span class="comment">// encode using utf-8</span></span><br><span class="line">            ba[--n] = c;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((c &gt; <span class="number">127</span>) &amp;&amp; (c &lt; <span class="number">2048</span>)) &#123;</span><br><span class="line">            ba[--n] = (c &amp; <span class="number">63</span>) | <span class="number">128</span>;</span><br><span class="line">            ba[--n] = (c &gt;&gt; <span class="number">6</span>) | <span class="number">192</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            ba[--n] = (c &amp; <span class="number">63</span>) | <span class="number">128</span>;</span><br><span class="line">            ba[--n] = ((c &gt;&gt; <span class="number">6</span>) &amp; <span class="number">63</span>) | <span class="number">128</span>;</span><br><span class="line">            ba[--n] = (c &gt;&gt; <span class="number">12</span>) | <span class="number">224</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 前面的都一样,但是处理完数据之后,就该填充0了,这时候就不一样了</span></span><br><span class="line">    <span class="keyword">while</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        ba[--n] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BigInteger</span>(ba);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添一个判断model的逻辑</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">RSAKey</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">encrypt</span> = <span class="keyword">function</span> (<span class="params">text, model</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> maxLength = (<span class="variable language_">this</span>.<span class="property">n</span>.<span class="title function_">bitLength</span>() + <span class="number">7</span>) &gt;&gt; <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">var</span> m;</span><br><span class="line">    <span class="comment">// 还是保留默认是PKCS#1</span></span><br><span class="line">    <span class="keyword">if</span> (model == <span class="string">&quot;PKCSPadding&quot;</span> || model == <span class="literal">undefined</span> || model == <span class="literal">null</span>) &#123;</span><br><span class="line">        m = <span class="title function_">pkcs1pad2</span>(text, maxLength);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (model == <span class="string">&quot;NOPadding&quot;</span>) &#123;</span><br><span class="line">        m = <span class="title function_">nopkcs</span>(text, maxLength)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Invalid padding model&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (m == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> c = <span class="variable language_">this</span>.<span class="title function_">doPublic</span>(m);</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> h = c.<span class="title function_">toString</span>(<span class="number">16</span>);</span><br><span class="line">    <span class="keyword">var</span> length = h.<span class="property">length</span>;</span><br><span class="line">    <span class="comment">// fix zero before result</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; maxLength * <span class="number">2</span> - length; i++) &#123;</span><br><span class="line">        h = <span class="string">&quot;0&quot;</span> + h;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> h;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<p>更改传入值，可以发现这之只是改了加密，还没改解密，不着急，先让这个传入两个参数，base形式的就先放一放</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241118210735767-1732016006153-6.png" alt="image-20241118210735767"></p>
<p>在相应的文件中更改，打断点调试的时候还是源代码，待我稍作思量，更益其巧</p>
<p>找到这个文件，上面有各个文件的信息啥的，代码没有被解析，怎么说呢，直接改吧</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241119145222944-1732016006153-7.png" alt="image-20241119145222944"></p>
<p>调用时，多接收一个参数</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241118211817786-1732016006153-8.png" alt="image-20241118211817786"></p>
<p>&#x2F;&#x2F; 处理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">判断方法</span><br><span class="line">\n        var m;\n        // 还是保留默认的是PKCS#1\n        if (model == &#x27;PKCSPadding&#x27; || model == undefined || model == null) &#123;/n            m = pkcs1pad2(text, maxLength);/n        &#125; else if (model == &#x27;NOPadding&#x27;) &#123;\n            m = nopkcs(text, maxLength);\n        &#125; else &#123;\n            console.error(&#x27;Invalid padding model&#x27;);\n            returm null;\n        &#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Nopadding填充操作</span><br><span class="line">function nopkcs(s, n) &#123;\n    if (n &lt; s.length) &#123;\n        console.error(&#x27;Message too long for RSA&#x27;);\n        return null;\n    &#125;\n    var ba = [];\n    var i = s.length - 1;\n    while (i &gt;= 0 &amp;&amp; n &gt; 0) &#123;\n        var c = s.charCodeAt(i--);\n        if (c &lt; 128) &#123;\n            ba[--n] = c;\n        &#125;\n        else if ((c &gt; 127) &amp;&amp; (c &lt; 2024)) &#123;\n            ba[--n] = (c &amp; 63) | 128;\n            ba[--n] = (c &gt;&gt; 6) | 192;\n        &#125;\n        else &#123;\n            ba[--n] = (c &amp; 63) | 128;\n            ba[--n] = ((c &gt;&gt; 6) &amp; 63) | 128;\n            ba[--n] = (c &gt;&gt; 12) | 224;\n        &#125;    \n    &#125;\n    // 前面的都一样，但是处理完数据之后，就改填充0了，这时候就比PKSC简单了\n    while (--n &gt; 0) &#123;\n        ba[--n] = 0;\n    &#125;\n     return new _jsbn__WEBPACK_IMPORTED_MODULE_0__.BigInteger(ba);\n&#125;</span><br></pre></td></tr></table></figure>



<p>大功告成</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241119144624973-1732016006153-9.png" alt="image-20241119144624973"></p>
<p>验证一下</p>
<p>无需多言，还有解密</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241119145500510-1732016006153-10.png" alt="image-20241119145500510"></p>
<p>接下来写NOPadding的解密</p>
<p>和加密的套路差不多，先检验是否有私钥，然后获取 base64转hex 的方法，将密文转成hex</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241119153831614-1732016006153-11.png" alt="image-20241119153831614"></p>
<p>然后就是重点了</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241119154429072-1732016006153-12.png" alt="image-20241119154429072"></p>
<p>这个C是处理hex数据的和解密无关，m我也看了一下直接用就行，真正处理的在 return上，这样也省事了，开始微操</p>
<p>加一个判断，通过打断点发现，这个m比较短，也就是说很可能就是明文的一种编码，反复实验之后先将这个 BigInteger 类型的数据转换成 byte 数组，然后将byte数组转换成utf-8的数据，有点弯弯绕。</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241119165204122-1732016006153-13.png" alt="image-20241119165204122"></p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;return m;</span><br><span class="line">&gt;BigInteger &#123; &#x27;0&#x27;: 53753142, &#x27;1&#x27;: 201507, s: 0, t: 2 &#125;</span><br><span class="line"></span><br><span class="line">&gt;return m.toByteArray();</span><br><span class="line">&gt;[ 49, 50, 51, 52, 53, 54 ]</span><br><span class="line"></span><br><span class="line">&gt;return String.fromCharCode.apply(null, m.toByteArray());</span><br><span class="line">&gt;123456</span><br></pre></td></tr></table></figure>


</blockquote>
<p>需要更改的位置有</p>
<p>这个是调试视图，去那一堆没解析的乱码里去改！就不放图片了</p>
<p><img src="/../%E5%9B%BE%E7%89%87/image-20241119165810685-1732016006153-14.png" alt="image-20241119165810685"></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%AE%89%E5%8D%93%E9%80%86%E5%90%91/" rel="tag"># 安卓逆向</a>
              <a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" rel="tag"># 密码学</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/11/19/JSEncrypt%E6%B7%BB%E5%8A%A0NOPadding%E5%A1%AB%E5%85%85/" rel="prev" title="JSEncrypt添加NOPadding填充">
      <i class="fa fa-chevron-left"></i> JSEncrypt添加NOPadding填充
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/12/06/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0-0x09NDK%E5%BC%80%E5%8F%91/" rel="next" title="逆向学习 0x09NDK开发">
      逆向学习 0x09NDK开发 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AF%86%E7%A0%81%E5%AD%A6"><span class="nav-number">1.</span> <span class="nav-text">密码学</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#H5%E7%9A%84app%E9%80%86%E5%90%91"><span class="nav-number">1.0.1.</span> <span class="nav-text">H5的app逆向</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WebView%E8%B0%83%E8%AF%95%E5%87%86%E5%A4%87"><span class="nav-number">1.0.2.</span> <span class="nav-text">WebView调试准备</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HEX%E7%BC%96%E7%A0%81"><span class="nav-number">1.1.</span> <span class="nav-text">HEX编码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#hex%E7%BC%96%E7%A0%81%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%8F%8A%E7%A0%81%E8%A1%A8"><span class="nav-number">1.1.1.</span> <span class="nav-text">hex编码的代码实现及码表</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Base64%E7%BC%96%E7%A0%81"><span class="nav-number">1.2.</span> <span class="nav-text">Base64编码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%E5%B0%81%E8%A3%85"><span class="nav-number">1.2.1.</span> <span class="nav-text">工具函数封装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%A1%E6%81%AF%E6%91%98%E8%A6%81%E7%AE%97%E6%B3%95"><span class="nav-number">1.3.</span> <span class="nav-text">信息摘要算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MD5"><span class="nav-number">1.3.1.</span> <span class="nav-text">MD5</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%97%E6%B3%95%E5%8A%A0%E7%9B%90"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">算法加盐</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SHA"><span class="nav-number">1.3.2.</span> <span class="nav-text">SHA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%97%E6%B3%95%E9%80%9A%E6%9D%80"><span class="nav-number">1.3.3.</span> <span class="nav-text">算法通杀</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MD5%E7%9A%84hook"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">MD5的hook</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SHA-1"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">SHA</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MAC%E7%AE%97%E6%B3%95"><span class="nav-number">1.3.4.</span> <span class="nav-text">MAC算法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#hook-MAC%E7%AE%97%E6%B3%95"><span class="nav-number">1.3.4.1.</span> <span class="nav-text">hook MAC算法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95"><span class="nav-number">1.4.</span> <span class="nav-text">对称加密算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DES%E7%AE%97%E6%B3%95"><span class="nav-number">1.4.1.</span> <span class="nav-text">DES算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A0%E5%AF%86%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.4.2.</span> <span class="nav-text">加密模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ECB%E6%A8%A1%E5%BC%8F%E5%92%8CCBC%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">ECB模式和CBC模式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A1%AB%E5%85%85%E6%96%B9%E5%BC%8F"><span class="nav-number">1.4.3.</span> <span class="nav-text">填充方式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#DES%E5%AF%86%E9%92%A5%E7%9A%84%E6%BC%8F%E6%B4%9E"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">DES密钥的漏洞</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DESede%E7%AE%97%E6%B3%95"><span class="nav-number">1.4.4.</span> <span class="nav-text">DESede算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AES%E7%AE%97%E6%B3%95"><span class="nav-number">1.4.5.</span> <span class="nav-text">AES算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E6%9D%80hook"><span class="nav-number">1.4.6.</span> <span class="nav-text">通杀hook</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#DES"><span class="nav-number">1.4.6.1.</span> <span class="nav-text">DES</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DESede"><span class="nav-number">1.4.6.2.</span> <span class="nav-text">DESede</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#AES"><span class="nav-number">1.4.6.3.</span> <span class="nav-text">AES</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95"><span class="nav-number">1.5.</span> <span class="nav-text">非对称加密算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RSA"><span class="nav-number">1.5.1.</span> <span class="nav-text">RSA</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A7%81%E9%92%A5%E7%9A%84%E6%A0%BC%E5%BC%8F"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">私钥的格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RSA%E5%AF%86%E9%92%A5%E7%9A%84%E8%A7%A3%E6%9E%90"><span class="nav-number">1.5.1.2.</span> <span class="nav-text">RSA密钥的解析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RSA%E5%8A%A0%E8%A7%A3%E5%AF%86"><span class="nav-number">1.5.1.3.</span> <span class="nav-text">RSA加解密</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RSAd%E7%9A%84%E5%8A%A0%E5%AF%86%E6%A8%A1%E5%BC%8F%E5%92%8C%E5%A1%AB%E5%85%85%E6%96%B9%E5%BC%8F"><span class="nav-number">1.5.1.4.</span> <span class="nav-text">RSAd的加密模式和填充方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RSA%E5%AF%86%E9%92%A5%E7%9A%84%E8%BD%AC%E6%8D%A2"><span class="nav-number">1.5.1.5.</span> <span class="nav-text">RSA密钥的转换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RSAhook"><span class="nav-number">1.5.1.6.</span> <span class="nav-text">RSAhook</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%97%E6%B3%95%E5%B8%B8%E8%A7%81%E3%81%AE%E5%A5%97%E8%B7%AF"><span class="nav-number">1.6.</span> <span class="nav-text">算法常见の套路</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E7%AE%97%E6%B3%95"><span class="nav-number">1.7.</span> <span class="nav-text">数字签名算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E7%AE%97%E6%B3%95hook%E9%80%9A%E6%9D%80"><span class="nav-number">1.7.1.</span> <span class="nav-text">数字签名算法hook通杀</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CryptoJS"><span class="nav-number">1.8.</span> <span class="nav-text">CryptoJS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%A1%E6%81%AF%E6%91%98%E8%A6%81%E7%AE%97%E6%B3%95%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.8.1.</span> <span class="nav-text">信息摘要算法的实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A7%A3%E6%9E%90"><span class="nav-number">1.8.2.</span> <span class="nav-text">字符串解析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#String%E8%BD%ACwordArray"><span class="nav-number">1.8.2.1.</span> <span class="nav-text">String转wordArray</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#wordArray%E8%BD%ACString"><span class="nav-number">1.8.2.2.</span> <span class="nav-text">wordArray转String</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95-1"><span class="nav-number">1.8.3.</span> <span class="nav-text">对称加密算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E7%AE%97%E6%B3%95"><span class="nav-number">1.8.4.</span> <span class="nav-text">其他算法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RIPEMD160-%E5%92%8C-HmacRIPEMD160"><span class="nav-number">1.8.4.1.</span> <span class="nav-text">RIPEMD160 和 HmacRIPEMD160</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PBKDF2-%E5%92%8C-EvpKDF"><span class="nav-number">1.8.4.2.</span> <span class="nav-text">PBKDF2 和 EvpKDF</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#jsencrypt"><span class="nav-number">1.9.</span> <span class="nav-text">jsencrypt</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95-1"><span class="nav-number">1.9.1.</span> <span class="nav-text">非对称加密算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JSEncrypt%E6%B7%BB%E5%8A%A0NOPadding%E5%A1%AB%E5%85%85"><span class="nav-number">1.9.2.</span> <span class="nav-text">JSEncrypt添加NOPadding填充</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="没事数命的猫"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">没事数命的猫</p>
  <div class="site-description" itemprop="description">学而不思则罔</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">25</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">没事数命的猫</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">148k</span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

-->

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>

<!-- 点击效果 -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript" src="/js/love-click.js"></script>